/*! For license information please see main.js.LICENSE.txt */
(()=>{var e,t,s={1:(e,t,s)=>{const n=s(18),r=s(23);t.init=function(e){e.inspectOpts={};const s=Object.keys(t.inspectOpts);for(let n=0;n<s.length;n++)e.inspectOpts[s[n]]=t.inspectOpts[s[n]]},t.log=function(...e){return process.stderr.write(r.formatWithOptions(t.inspectOpts,...e)+"\n")},t.formatArgs=function(s){const{namespace:n,useColors:r}=this;if(r){const t=this.color,r="[3"+(t<8?t:"8;5;"+t),o=`  ${r};1m${n} [0m`;s[0]=o+s[0].split("\n").join("\n"+o),s.push(r+"m+"+e.exports.humanize(this.diff)+"[0m")}else s[0]=(t.inspectOpts.hideDate?"":(new Date).toISOString()+" ")+n+" "+s[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):n.isatty(process.stderr.fd)},t.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const e=s(687);e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{const s=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase());let n=process.env[t];return n=!!/^(yes|on|true|enabled)$/i.test(n)||!/^(no|off|false|disabled)$/i.test(n)&&("null"===n?null:Number(n)),e[s]=n,e},{}),e.exports=s(40)(t);const{formatters:o}=e.exports;o.o=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts).split("\n").map(e=>e.trim()).join(" ")},o.O=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts)}},16:e=>{"use strict";e.exports=require("url")},18:e=>{"use strict";e.exports=require("tty")},23:e=>{"use strict";e.exports=require("util")},40:(e,t,s)=>{e.exports=function(e){function t(e){let s,r,o,i=null;function a(...e){if(!a.enabled)return;const n=a,r=Number(new Date),o=r-(s||r);n.diff=o,n.prev=s,n.curr=r,s=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(s,r)=>{if("%%"===s)return"%";i++;const o=t.formatters[r];if("function"==typeof o){const t=e[i];s=o.call(n,t),e.splice(i,1),i--}return s}),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(r!==t.namespaces&&(r=t.namespaces,o=t.enabled(e)),o),set:e=>{i=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,s){const n=t(this.namespace+(void 0===s?":":s)+e);return n.log=this.log,n}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(r),...t.skips.map(r).map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){let s;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(s=0;s<r;s++)n[s]&&("-"===(e=n[s].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let s,n;for(s=0,n=t.skips.length;s<n;s++)if(t.skips[s].test(e))return!1;for(s=0,n=t.names.length;s<n;s++)if(t.names[s].test(e))return!0;return!1},t.humanize=s(585),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(s=>{t[s]=e[s]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let s=0;for(let t=0;t<e.length;t++)s=(s<<5)-s+e.charCodeAt(t),s|=0;return t.colors[Math.abs(s)%t.colors.length]},t.enable(t.load()),t}},60:(e,t,s)=>{"use strict";const n=s(434),r=s(692),o=s(611),i=s(278),a=s(756),{randomBytes:c,createHash:h}=s(982),{Duplex:d,Readable:l}=s(203),{URL:u}=s(16),p=s(971),f=s(286),y=s(914),{BINARY_TYPES:m,EMPTY_BUFFER:_,GUID:g,kForOnEventAttribute:E,kListener:b,kStatusCode:T,kWebSocket:w,NOOP:C}=s(614),{EventTarget:{addEventListener:v,removeEventListener:S}}=s(597),{format:O,parse:k}=s(926),{toBuffer:N}=s(338),L=Symbol("kAborted"),x=[8,13],R=["CONNECTING","OPEN","CLOSING","CLOSED"],A=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class F extends n{constructor(e,t,s){super(),this._binaryType=m[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=_,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=F.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(s=t,t=[]):t=[t]),I(this,e,t,s)):(this._autoPong=s.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){m.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,s){const n=new f({allowSynchronousEvents:s.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation});this._sender=new y(e,this._extensions,s.generateMask),this._receiver=n,this._socket=e,n[w]=this,e[w]=this,n.on("conclude",j),n.on("drain",q),n.on("error",W),n.on("message",$),n.on("ping",V),n.on("pong",G),e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",z),e.on("data",Y),e.on("end",J),e.on("error",K),this._readyState=F.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=F.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[p.extensionName]&&this._extensions[p.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=F.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==F.CLOSED){if(this.readyState===F.CONNECTING){const e="WebSocket was closed before the connection was established";return void P(this,this._req,e)}this.readyState!==F.CLOSING?(this._readyState=F.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end()}}pause(){this.readyState!==F.CONNECTING&&this.readyState!==F.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,s){if(this.readyState===F.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===F.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||_,t,s)):B(this,e,s)}pong(e,t,s){if(this.readyState===F.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===F.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||_,t,s)):B(this,e,s)}resume(){this.readyState!==F.CONNECTING&&this.readyState!==F.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,s){if(this.readyState===F.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(s=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==F.OPEN)return void B(this,e,s);const n={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[p.extensionName]||(n.compress=!1),this._sender.send(e||_,n,s)}terminate(){if(this.readyState!==F.CLOSED){if(this.readyState===F.CONNECTING){const e="WebSocket was closed before the connection was established";return void P(this,this._req,e)}this._socket&&(this._readyState=F.CLOSING,this._socket.destroy())}}}function I(e,t,s,n){const i={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:x[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(e._autoPong=i.autoPong,!x.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${x.join(", ")})`);let a;if(t instanceof u)a=t;else try{a=new u(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}"http:"===a.protocol?a.protocol="ws:":"https:"===a.protocol&&(a.protocol="wss:"),e._url=a.href;const d="wss:"===a.protocol,l="ws+unix:"===a.protocol;let f;if("ws:"===a.protocol||d||l?l&&!a.pathname?f="The URL's pathname is empty":a.hash&&(f="The URL contains a fragment identifier"):f='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"',f){const t=new SyntaxError(f);if(0===e._redirects)throw t;return void U(e,t)}const y=d?443:80,m=c(16).toString("base64"),_=d?r.request:o.request,E=new Set;let b,T;if(i.createConnection=i.createConnection||(d?M:D),i.defaultPort=i.defaultPort||y,i.port=a.port||y,i.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,i.headers={...i.headers,"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":m,Connection:"Upgrade",Upgrade:"websocket"},i.path=a.pathname+a.search,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(b=new p(!0!==i.perMessageDeflate?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=O({[p.extensionName]:b.offer()})),s.length){for(const e of s){if("string"!=typeof e||!A.test(e)||E.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");E.add(e)}i.headers["Sec-WebSocket-Protocol"]=s.join(",")}if(i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),(a.username||a.password)&&(i.auth=`${a.username}:${a.password}`),l){const e=i.path.split(":");i.socketPath=e[0],i.path=e[1]}if(i.followRedirects){if(0===e._redirects){e._originalIpc=l,e._originalSecure=d,e._originalHostOrSocketPath=l?i.socketPath:a.host;const t=n&&n.headers;if(n={...n,headers:{}},t)for(const[e,s]of Object.entries(t))n.headers[e.toLowerCase()]=s}else if(0===e.listenerCount("redirect")){const t=l?!!e._originalIpc&&i.socketPath===e._originalHostOrSocketPath:!e._originalIpc&&a.host===e._originalHostOrSocketPath;(!t||e._originalSecure&&!d)&&(delete i.headers.authorization,delete i.headers.cookie,t||delete i.headers.host,i.auth=void 0)}i.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(i.auth).toString("base64")),T=e._req=_(i),e._redirects&&e.emit("redirect",e.url,T)}else T=e._req=_(i);i.timeout&&T.on("timeout",()=>{P(e,T,"Opening handshake has timed out")}),T.on("error",t=>{null===T||T[L]||(T=e._req=null,U(e,t))}),T.on("response",r=>{const o=r.headers.location,a=r.statusCode;if(o&&i.followRedirects&&a>=300&&a<400){if(++e._redirects>i.maxRedirects)return void P(e,T,"Maximum redirects exceeded");let r;T.abort();try{r=new u(o,t)}catch(t){const s=new SyntaxError(`Invalid URL: ${o}`);return void U(e,s)}I(e,r,s,n)}else e.emit("unexpected-response",T,r)||P(e,T,`Unexpected server response: ${r.statusCode}`)}),T.on("upgrade",(t,s,n)=>{if(e.emit("upgrade",t),e.readyState!==F.CONNECTING)return;T=e._req=null;const r=t.headers.upgrade;if(void 0===r||"websocket"!==r.toLowerCase())return void P(e,s,"Invalid Upgrade header");const o=h("sha1").update(m+g).digest("base64");if(t.headers["sec-websocket-accept"]!==o)return void P(e,s,"Invalid Sec-WebSocket-Accept header");const a=t.headers["sec-websocket-protocol"];let c;if(void 0!==a?E.size?E.has(a)||(c="Server sent an invalid subprotocol"):c="Server sent a subprotocol but none was requested":E.size&&(c="Server sent no subprotocol"),c)return void P(e,s,c);a&&(e._protocol=a);const d=t.headers["sec-websocket-extensions"];if(void 0!==d){if(!b)return void P(e,s,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");let t;try{t=k(d)}catch(t){return void P(e,s,"Invalid Sec-WebSocket-Extensions header")}const n=Object.keys(t);if(1!==n.length||n[0]!==p.extensionName)return void P(e,s,"Server indicated an extension that was not requested");try{b.accept(t[p.extensionName])}catch(t){return void P(e,s,"Invalid Sec-WebSocket-Extensions header")}e._extensions[p.extensionName]=b}e.setSocket(s,n,{allowSynchronousEvents:i.allowSynchronousEvents,generateMask:i.generateMask,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation})}),i.finishRequest?i.finishRequest(T,e):T.end()}function U(e,t){e._readyState=F.CLOSING,e.emit("error",t),e.emitClose()}function D(e){return e.path=e.socketPath,i.connect(e)}function M(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=i.isIP(e.host)?"":e.host),a.connect(e)}function P(e,t,s){e._readyState=F.CLOSING;const n=new Error(s);Error.captureStackTrace(n,P),t.setHeader?(t[L]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(U,e,n)):(t.destroy(n),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function B(e,t,s){if(t){const s=N(t).length;e._socket?e._sender._bufferedBytes+=s:e._bufferedAmount+=s}if(s){const t=new Error(`WebSocket is not open: readyState ${e.readyState} (${R[e.readyState]})`);process.nextTick(s,t)}}function j(e,t){const s=this[w];s._closeFrameReceived=!0,s._closeMessage=t,s._closeCode=e,void 0!==s._socket[w]&&(s._socket.removeListener("data",Y),process.nextTick(H,s._socket),1005===e?s.close():s.close(e,t))}function q(){const e=this[w];e.isPaused||e._socket.resume()}function W(e){const t=this[w];void 0!==t._socket[w]&&(t._socket.removeListener("data",Y),process.nextTick(H,t._socket),t.close(e[T])),t.emit("error",e)}function X(){this[w].emitClose()}function $(e,t){this[w].emit("message",e,t)}function V(e){const t=this[w];t._autoPong&&t.pong(e,!this._isServer,C),t.emit("ping",e)}function G(e){this[w].emit("pong",e)}function H(e){e.resume()}function z(){const e=this[w];let t;this.removeListener("close",z),this.removeListener("data",Y),this.removeListener("end",J),e._readyState=F.CLOSING,this._readableState.endEmitted||e._closeFrameReceived||e._receiver._writableState.errorEmitted||null===(t=e._socket.read())||e._receiver.write(t),e._receiver.end(),this[w]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",X),e._receiver.on("finish",X))}function Y(e){this[w]._receiver.write(e)||this.pause()}function J(){const e=this[w];e._readyState=F.CLOSING,e._receiver.end(),this.end()}function K(){const e=this[w];this.removeListener("error",K),this.on("error",C),e&&(e._readyState=F.CLOSING,this.destroy())}Object.defineProperty(F,"CONNECTING",{enumerable:!0,value:R.indexOf("CONNECTING")}),Object.defineProperty(F.prototype,"CONNECTING",{enumerable:!0,value:R.indexOf("CONNECTING")}),Object.defineProperty(F,"OPEN",{enumerable:!0,value:R.indexOf("OPEN")}),Object.defineProperty(F.prototype,"OPEN",{enumerable:!0,value:R.indexOf("OPEN")}),Object.defineProperty(F,"CLOSING",{enumerable:!0,value:R.indexOf("CLOSING")}),Object.defineProperty(F.prototype,"CLOSING",{enumerable:!0,value:R.indexOf("CLOSING")}),Object.defineProperty(F,"CLOSED",{enumerable:!0,value:R.indexOf("CLOSED")}),Object.defineProperty(F.prototype,"CLOSED",{enumerable:!0,value:R.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(F.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(F.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[E])return t[b];return null},set(t){for(const t of this.listeners(e))if(t[E]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[E]:!0})}})}),F.prototype.addEventListener=v,F.prototype.removeEventListener=S,e.exports=F},106:e=>{"use strict";e.exports=require("zlib")},120:(e,t,s)=>{"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?e.exports=s(852):e.exports=s(382)},181:e=>{"use strict";e.exports=require("buffer")},203:e=>{"use strict";e.exports=require("stream")},237:(e,t,s)=>{"use strict";const{tokenChars:n}=s(880);e.exports={parse:function(e){const t=new Set;let s=-1,r=-1,o=0;for(;o<e.length;o++){const i=e.charCodeAt(o);if(-1===r&&1===n[i])-1===s&&(s=o);else if(0===o||32!==i&&9!==i){if(44!==i)throw new SyntaxError(`Unexpected character at index ${o}`);{if(-1===s)throw new SyntaxError(`Unexpected character at index ${o}`);-1===r&&(r=o);const n=e.slice(s,r);if(t.has(n))throw new SyntaxError(`The "${n}" subprotocol is duplicated`);t.add(n),s=r=-1}}else-1===r&&-1!==s&&(r=o)}if(-1===s||-1!==r)throw new SyntaxError("Unexpected end of input");const i=e.slice(s,o);if(t.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return t.add(i),t}}},278:e=>{"use strict";e.exports=require("net")},286:(e,t,s)=>{"use strict";const{Writable:n}=s(203),r=s(971),{BINARY_TYPES:o,EMPTY_BUFFER:i,kStatusCode:a,kWebSocket:c}=s(614),{concat:h,toArrayBuffer:d,unmask:l}=s(338),{isValidStatusCode:u,isValidUTF8:p}=s(880),f=Buffer[Symbol.species];e.exports=class extends n{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||o[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[c]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,s){if(8===this._opcode&&0==this._state)return s();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(s)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=new f(t.buffer,t.byteOffset+e,t.length-e),new f(t.buffer,t.byteOffset,e)}const t=Buffer.allocUnsafe(e);do{const s=this._buffers[0],n=t.length-e;e>=s.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(s.buffer,s.byteOffset,e),n),this._buffers[0]=new f(s.buffer,s.byteOffset+e,s.length-e)),e-=s.length}while(e>0);return t}startLoop(e){this._loop=!0;do{switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:return void(this._loop=!1)}}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2)return void(this._loop=!1);const t=this.consume(2);if(48&t[0])return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));const s=!(64&~t[0]);if(!s||this._extensions[r.extensionName]){if(this._fin=!(128&~t[0]),this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(s)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=s}else{if(!(this._opcode>7&&this._opcode<11))return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(s)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=!(128&~t[1]),this._isServer){if(!this._masked)return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}else e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}getPayloadLength16(e){this._bufferedBytes<2?this._loop=!1:(this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e))}getPayloadLength64(e){if(this._bufferedBytes<8)return void(this._loop=!1);const t=this.consume(8),s=t.readUInt32BE(0);s>Math.pow(2,21)-1?e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=s*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e))}haveLength(e){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=i;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!==(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&l(t,this._mask)}if(this._opcode>7)this.controlMessage(t,e);else{if(this._compressed)return this._state=5,void this.decompress(t,e);t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}}decompress(e,t){this._extensions[r.extensionName].decompress(e,this._fin,(e,s)=>{if(e)return t(e);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0){const e=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");return void t(e)}this._fragments.push(s)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin)return void(this._state=0);const t=this._messageLength,s=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let n;n="nodebuffer"===this._binaryType?h(s,t):"arraybuffer"===this._binaryType?d(h(s,t)):s,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!0),this._state=0,this.startLoop(e)}))}else{const n=h(s,t);if(!this._skipUTF8Validation&&!p(n)){const t=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void e(t)}5===this._state||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8!==this._opcode)this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}));else{if(0===e.length)this._loop=!1,this.emit("conclude",1005,i),this.end();else{const s=e.readUInt16BE(0);if(!u(s)){const e=this.createError(RangeError,`invalid status code ${s}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");return void t(e)}const n=new f(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!p(n)){const e=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void t(e)}this._loop=!1,this.emit("conclude",s,n),this.end()}this._state=0}}createError(e,t,s,n,r){this._loop=!1,this._errored=!0;const o=new e(s?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=r,o[a]=n,o}}},300:(e,t,s)=>{"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?e.exports=s(368):e.exports=s(834)},317:e=>{"use strict";e.exports=require("child_process")},338:(e,t,s)=>{"use strict";const{EMPTY_BUFFER:n}=s(614),r=Buffer[Symbol.species];function o(e,t,s,n,r){for(let o=0;o<r;o++)s[n+o]=e[o]^t[3&o]}function i(e,t){for(let s=0;s<e.length;s++)e[s]^=t[3&s]}if(e.exports={concat:function(e,t){if(0===e.length)return n;if(1===e.length)return e[0];const s=Buffer.allocUnsafe(t);let o=0;for(let t=0;t<e.length;t++){const n=e[t];s.set(n,o),o+=n.length}return o<t?new r(s.buffer,s.byteOffset,o):s},mask:o,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(t){if(e.readOnly=!0,Buffer.isBuffer(t))return t;let s;return t instanceof ArrayBuffer?s=new r(t):ArrayBuffer.isView(t)?s=new r(t.buffer,t.byteOffset,t.byteLength):(s=Buffer.from(t),e.readOnly=!1),s},unmask:i},!process.env.WS_NO_BUFFER_UTIL)try{const t=s(Object(function(){var e=new Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e}()));e.exports.mask=function(e,s,n,r,i){i<48?o(e,s,n,r,i):t.mask(e,s,n,r,i)},e.exports.unmask=function(e,s){e.length<32?i(e,s):t.unmask(e,s)}}catch(e){}},368:(e,t,s)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const s="color: "+this.color;t.splice(1,0,s,"color: inherit");let n=0,r=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(r=n))}),t.splice(r,0,s)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=s(703)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},382:(e,t,s)=>{const n=s(18),r=s(23);t.init=function(e){e.inspectOpts={};const s=Object.keys(t.inspectOpts);for(let n=0;n<s.length;n++)e.inspectOpts[s[n]]=t.inspectOpts[s[n]]},t.log=function(...e){return process.stderr.write(r.formatWithOptions(t.inspectOpts,...e)+"\n")},t.formatArgs=function(s){const{namespace:n,useColors:r}=this;if(r){const t=this.color,r="[3"+(t<8?t:"8;5;"+t),o=`  ${r};1m${n} [0m`;s[0]=o+s[0].split("\n").join("\n"+o),s.push(r+"m+"+e.exports.humanize(this.diff)+"[0m")}else s[0]=(t.inspectOpts.hideDate?"":(new Date).toISOString()+" ")+n+" "+s[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):n.isatty(process.stderr.fd)},t.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const e=s(687);e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{const s=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase());let n=process.env[t];return n=!!/^(yes|on|true|enabled)$/i.test(n)||!/^(no|off|false|disabled)$/i.test(n)&&("null"===n?null:Number(n)),e[s]=n,e},{}),e.exports=s(995)(t);const{formatters:o}=e.exports;o.o=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts).split("\n").map(e=>e.trim()).join(" ")},o.O=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts)}},434:e=>{"use strict";e.exports=require("events")},480:(e,t,s)=>{var n=s(896),r=s(16),o=s(317).spawn;function i(e){"use strict";e=e||{};var t,i,a=this,c=s(611),h=s(692),d={},l=!1,u={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},p=Object.assign({},u),f=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],y=["TRACE","TRACK","CONNECT"],m=!1,_=!1,g=!1,E={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.response=Buffer.alloc(0),this.status=null,this.statusText=null,this.open=function(e,t,s,n,r){if(this.abort(),_=!1,g=!1,!function(e){return e&&-1===y.indexOf(e)}(e))throw new Error("SecurityError: Request method not allowed");d={method:e,url:t.toString(),async:"boolean"!=typeof s||s,user:n||null,password:r||null},b(this.OPENED)},this.setDisableHeaderCheck=function(e){l=e},this.setRequestHeader=function(e,t){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!function(e){return l||e&&-1===f.indexOf(e.toLowerCase())}(e))return console.warn('Refused to set unsafe header "'+e+'"'),!1;if(m)throw new Error("INVALID_STATE_ERR: send flag is true");return p[e]=t,!0},this.getResponseHeader=function(e){return"string"==typeof e&&this.readyState>this.OPENED&&i.headers[e.toLowerCase()]&&!_?i.headers[e.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||_)return"";var e="";for(var t in i.headers)"set-cookie"!==t&&"set-cookie2"!==t&&(e+=t+": "+i.headers[t]+"\r\n");return e.substr(0,e.length-2)},this.getRequestHeader=function(e){return"string"==typeof e&&p[e]?p[e]:""},this.send=function(s){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(m)throw new Error("INVALID_STATE_ERR: send has already been called");var l,u=!1,f=!1,y=r.parse(d.url);switch(y.protocol){case"https:":u=!0;case"http:":l=y.hostname;break;case"file:":f=!0;break;case void 0:case"":l="localhost";break;default:throw new Error("Protocol not supported.")}if(f){if("GET"!==d.method)throw new Error("XMLHttpRequest: Only GET method is supported");if(d.async)n.readFile(unescape(y.pathname),function(e,t){e?a.handleError(e,e.errno||-1):(a.status=200,a.responseText=t.toString("utf8"),a.response=t,b(a.DONE))});else try{this.response=n.readFileSync(unescape(y.pathname)),this.responseText=this.response.toString("utf8"),this.status=200,b(a.DONE)}catch(e){this.handleError(e,e.errno||-1)}}else{var g=y.port||(u?443:80),E=y.pathname+(y.search?y.search:"");if(p.Host=l,u&&443===g||80===g||(p.Host+=":"+y.port),d.user){void 0===d.password&&(d.password="");var T=new Buffer(d.user+":"+d.password);p.Authorization="Basic "+T.toString("base64")}"GET"===d.method||"HEAD"===d.method?s=null:s?(p["Content-Length"]=Buffer.isBuffer(s)?s.length:Buffer.byteLength(s),Object.keys(p).some(function(e){return"content-type"===e.toLowerCase()})||(p["Content-Type"]="text/plain;charset=UTF-8")):"POST"===d.method&&(p["Content-Length"]=0);var w=e.agent||!1,C={host:l,port:g,path:E,method:d.method,headers:p,agent:w};if(u&&(C.pfx=e.pfx,C.key=e.key,C.passphrase=e.passphrase,C.cert=e.cert,C.ca=e.ca,C.ciphers=e.ciphers,C.rejectUnauthorized=!1!==e.rejectUnauthorized),_=!1,d.async){var v=u?h.request:c.request;m=!0,a.dispatchEvent("readystatechange");var S=function(s){if(302===(i=s).statusCode||303===i.statusCode||307===i.statusCode){d.url=i.headers.location;var n=r.parse(d.url);l=n.hostname;var o={hostname:n.hostname,port:n.port,path:n.path,method:303===i.statusCode?"GET":d.method,headers:p};return u&&(o.pfx=e.pfx,o.key=e.key,o.passphrase=e.passphrase,o.cert=e.cert,o.ca=e.ca,o.ciphers=e.ciphers,o.rejectUnauthorized=!1!==e.rejectUnauthorized),void(t=v(o,S).on("error",O)).end()}b(a.HEADERS_RECEIVED),a.status=i.statusCode,i.on("data",function(e){if(e){var t=Buffer.from(e);a.response=Buffer.concat([a.response,t])}m&&b(a.LOADING)}),i.on("end",function(){m&&(m=!1,b(a.DONE),a.responseText=a.response.toString("utf8"))}),i.on("error",function(e){a.handleError(e)})},O=function(e){if(t.reusedSocket&&"ECONNRESET"===e.code)return v(C,S).on("error",O);a.handleError(e)};t=v(C,S).on("error",O),e.autoUnref&&t.on("socket",e=>{e.unref()}),s&&t.write(s),t.end(),a.dispatchEvent("loadstart")}else{var k=".node-xmlhttprequest-content-"+process.pid,N=".node-xmlhttprequest-sync-"+process.pid;n.writeFileSync(N,"","utf8");for(var L="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(u?"s":"")+".request;var options = "+JSON.stringify(C)+";var responseText = '';var responseData = Buffer.alloc(0);var req = doRequest(options, function(response) {response.on('data', function(chunk) {  var data = Buffer.from(chunk);  responseText += data.toString('utf8');  responseData = Buffer.concat([responseData, data]);});response.on('end', function() {fs.writeFileSync('"+k+"', JSON.stringify({err: null, data: {statusCode: response.statusCode, headers: response.headers, text: responseText, data: responseData.toString('base64')}}), 'utf8');fs.unlinkSync('"+N+"');});response.on('error', function(error) {fs.writeFileSync('"+k+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+N+"');});}).on('error', function(error) {fs.writeFileSync('"+k+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+N+"');});"+(s?"req.write('"+JSON.stringify(s).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",x=o(process.argv[0],["-e",L]);n.existsSync(N););if(a.responseText=n.readFileSync(k,"utf8"),x.stdin.end(),n.unlinkSync(k),a.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var R=JSON.parse(a.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,""));a.handleError(R,503)}else{a.status=a.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1");var A=JSON.parse(a.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"));i={statusCode:a.status,headers:A.data.headers},a.responseText=A.data.text,a.response=Buffer.from(A.data.data,"base64"),b(a.DONE,!0)}}}},this.handleError=function(e,t){this.status=t||0,this.statusText=e,this.responseText=e.stack,_=!0,b(this.DONE)},this.abort=function(){t&&(t.abort(),t=null),p=Object.assign({},u),this.responseText="",this.responseXML="",this.response=Buffer.alloc(0),_=g=!0,this.readyState===this.UNSENT||this.readyState===this.OPENED&&!m||this.readyState===this.DONE||(m=!1,b(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(e,t){e in E||(E[e]=[]),E[e].push(t)},this.removeEventListener=function(e,t){e in E&&(E[e]=E[e].filter(function(e){return e!==t}))},this.dispatchEvent=function(e){if("function"==typeof a["on"+e]&&(this.readyState===this.DONE&&d.async?setTimeout(function(){a["on"+e]()},0):a["on"+e]()),e in E)for(let t=0,s=E[e].length;t<s;t++)this.readyState===this.DONE?setTimeout(function(){E[e][t].call(a)},0):E[e][t].call(a)};var b=function(e){if(!(a.readyState===e||a.readyState===a.UNSENT&&g)&&(a.readyState=e,(d.async||a.readyState<a.OPENED||a.readyState===a.DONE)&&a.dispatchEvent("readystatechange"),a.readyState===a.DONE)){let e;e=g?"abort":_?"error":"load",a.dispatchEvent(e),a.dispatchEvent("loadend")}}}e.exports=i,i.XMLHttpRequest=i},585:e=>{var t=1e3,s=60*t,n=60*s,r=24*n,o=7*r;function i(e,t,s,n){var r=t>=1.5*s;return Math.round(e/s)+" "+n+(r?"s":"")}e.exports=function(e,a){a=a||{};var c,h,d=typeof e;if("string"===d&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(i){var a=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return a*o;case"days":case"day":case"d":return a*r;case"hours":case"hour":case"hrs":case"hr":case"h":return a*n;case"minutes":case"minute":case"mins":case"min":case"m":return a*s;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===d&&isFinite(e))return a.long?(c=e,(h=Math.abs(c))>=r?i(c,h,r,"day"):h>=n?i(c,h,n,"hour"):h>=s?i(c,h,s,"minute"):h>=t?i(c,h,t,"second"):c+" ms"):function(e){var o=Math.abs(e);return o>=r?Math.round(e/r)+"d":o>=n?Math.round(e/n)+"h":o>=s?Math.round(e/s)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},597:(e,t,s)=>{"use strict";const{kForOnEventAttribute:n,kListener:r}=s(614),o=Symbol("kCode"),i=Symbol("kData"),a=Symbol("kError"),c=Symbol("kMessage"),h=Symbol("kReason"),d=Symbol("kTarget"),l=Symbol("kType"),u=Symbol("kWasClean");class p{constructor(e){this[d]=null,this[l]=e}get target(){return this[d]}get type(){return this[l]}}Object.defineProperty(p.prototype,"target",{enumerable:!0}),Object.defineProperty(p.prototype,"type",{enumerable:!0});class f extends p{constructor(e,t={}){super(e),this[o]=void 0===t.code?0:t.code,this[h]=void 0===t.reason?"":t.reason,this[u]=void 0!==t.wasClean&&t.wasClean}get code(){return this[o]}get reason(){return this[h]}get wasClean(){return this[u]}}Object.defineProperty(f.prototype,"code",{enumerable:!0}),Object.defineProperty(f.prototype,"reason",{enumerable:!0}),Object.defineProperty(f.prototype,"wasClean",{enumerable:!0});class y extends p{constructor(e,t={}){super(e),this[a]=void 0===t.error?null:t.error,this[c]=void 0===t.message?"":t.message}get error(){return this[a]}get message(){return this[c]}}Object.defineProperty(y.prototype,"error",{enumerable:!0}),Object.defineProperty(y.prototype,"message",{enumerable:!0});class m extends p{constructor(e,t={}){super(e),this[i]=void 0===t.data?null:t.data}get data(){return this[i]}}Object.defineProperty(m.prototype,"data",{enumerable:!0});const _={addEventListener(e,t,s={}){for(const o of this.listeners(e))if(!s[n]&&o[r]===t&&!o[n])return;let o;if("message"===e)o=function(e,s){const n=new m("message",{data:s?e:e.toString()});n[d]=this,g(t,this,n)};else if("close"===e)o=function(e,s){const n=new f("close",{code:e,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});n[d]=this,g(t,this,n)};else if("error"===e)o=function(e){const s=new y("error",{error:e,message:e.message});s[d]=this,g(t,this,s)};else{if("open"!==e)return;o=function(){const e=new p("open");e[d]=this,g(t,this,e)}}o[n]=!!s[n],o[r]=t,s.once?this.once(e,o):this.on(e,o)},removeEventListener(e,t){for(const s of this.listeners(e))if(s[r]===t&&!s[n]){this.removeListener(e,s);break}}};function g(e,t,s){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,s):e.call(t,s)}e.exports={CloseEvent:f,ErrorEvent:y,Event:p,EventTarget:_,MessageEvent:m}},611:e=>{"use strict";e.exports=require("http")},614:e=>{"use strict";e.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},617:(e,t,s)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const s="color: "+this.color;t.splice(1,0,s,"color: inherit");let n=0,r=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(r=n))}),t.splice(r,0,s)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=s(40)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},687:(e,t,s)=>{"use strict";const n=s(857),r=s(18),o=s(884),{env:i}=process;let a;function c(e,t={}){return 0!==(s=function(e,{streamIsTTY:t,sniffFlags:s=!0}={}){const r=function(){if("FORCE_COLOR"in i)return"true"===i.FORCE_COLOR?1:"false"===i.FORCE_COLOR?0:0===i.FORCE_COLOR.length?1:Math.min(Number.parseInt(i.FORCE_COLOR,10),3)}();void 0!==r&&(a=r);const c=s?a:r;if(0===c)return 0;if(s){if(o("color=16m")||o("color=full")||o("color=truecolor"))return 3;if(o("color=256"))return 2}if(e&&!t&&void 0===c)return 0;const h=c||0;if("dumb"===i.TERM)return h;if("win32"===process.platform){const e=n.release().split(".");return Number(e[0])>=10&&Number(e[2])>=10586?Number(e[2])>=14931?3:2:1}if("CI"in i)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(e=>e in i)||"codeship"===i.CI_NAME?1:h;if("TEAMCITY_VERSION"in i)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(i.TEAMCITY_VERSION)?1:0;if("truecolor"===i.COLORTERM)return 3;if("TERM_PROGRAM"in i){const e=Number.parseInt((i.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(i.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(i.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(i.TERM)||"COLORTERM"in i?1:h}(e,{streamIsTTY:e&&e.isTTY,...t}))&&{level:s,hasBasic:!0,has256:s>=2,has16m:s>=3};var s}o("no-color")||o("no-colors")||o("color=false")||o("color=never")?a=0:(o("color")||o("colors")||o("color=true")||o("color=always"))&&(a=1),e.exports={supportsColor:c,stdout:c({isTTY:r.isatty(1)}),stderr:c({isTTY:r.isatty(2)})}},692:e=>{"use strict";e.exports=require("https")},703:(e,t,s)=>{e.exports=function(e){function t(e){let s,r,o,i=null;function a(...e){if(!a.enabled)return;const n=a,r=Number(new Date),o=r-(s||r);n.diff=o,n.prev=s,n.curr=r,s=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(s,r)=>{if("%%"===s)return"%";i++;const o=t.formatters[r];if("function"==typeof o){const t=e[i];s=o.call(n,t),e.splice(i,1),i--}return s}),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(r!==t.namespaces&&(r=t.namespaces,o=t.enabled(e)),o),set:e=>{i=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,s){const n=t(this.namespace+(void 0===s?":":s)+e);return n.log=this.log,n}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(r),...t.skips.map(r).map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){let s;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(s=0;s<r;s++)n[s]&&("-"===(e=n[s].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let s,n;for(s=0,n=t.skips.length;s<n;s++)if(t.skips[s].test(e))return!1;for(s=0,n=t.names.length;s<n;s++)if(t.names[s].test(e))return!0;return!1},t.humanize=s(585),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(s=>{t[s]=e[s]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let s=0;for(let t=0;t<e.length;t++)s=(s<<5)-s+e.charCodeAt(t),s|=0;return t.colors[Math.abs(s)%t.colors.length]},t.enable(t.load()),t}},719:(e,t,s)=>{"use strict";const{Duplex:n}=s(203);function r(e){e.emit("close")}function o(){!this.destroyed&&this._writableState.finished&&this.destroy()}function i(e){this.removeListener("error",i),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let s=!0;const a=new n({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,s){const n=!s&&a._readableState.objectMode?t.toString():t;a.push(n)||e.pause()}),e.once("error",function(e){a.destroyed||(s=!1,a.destroy(e))}),e.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(t,n){if(e.readyState===e.CLOSED)return n(t),void process.nextTick(r,a);let o=!1;e.once("error",function(e){o=!0,n(e)}),e.once("close",function(){o||n(t),process.nextTick(r,a)}),s&&e.terminate()},a._final=function(t){e.readyState!==e.CONNECTING?null!==e._socket&&(e._socket._writableState.finished?(t(),a._readableState.endEmitted&&a.destroy()):(e._socket.once("finish",function(){t()}),e.close())):e.once("open",function(){a._final(t)})},a._read=function(){e.isPaused&&e.resume()},a._write=function(t,s,n){e.readyState!==e.CONNECTING?e.send(t,n):e.once("open",function(){a._write(t,s,n)})},a.on("end",o),a.on("error",i),a}},722:(e,t,s)=>{"use strict";const n=s(434),r=s(611),{Duplex:o}=s(203),{createHash:i}=s(982),a=s(926),c=s(971),h=s(237),d=s(60),{GUID:l,kWebSocket:u}=s(614),p=/^[+/0-9A-Za-z]{22}==$/;function f(e){e._state=2,e.emit("close")}function y(){this.destroy()}function m(e,t,s,n){s=s||r.STATUS_CODES[t],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(s),...n},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${r.STATUS_CODES[t]}\r\n`+Object.keys(n).map(e=>`${e}: ${n[e]}`).join("\r\n")+"\r\n\r\n"+s)}function _(e,t,s,n,r){if(e.listenerCount("wsClientError")){const n=new Error(r);Error.captureStackTrace(n,_),e.emit("wsClientError",n,s,t)}else m(s,n,r)}e.exports=class extends n{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:d,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=r.createServer((e,t)=>{const s=r.STATUS_CODES[426];t.writeHead(426,{"Content-Length":s.length,"Content-Type":"text/plain"}),t.end(s)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(const s of Object.keys(t))e.on(s,t[s]);return function(){for(const s of Object.keys(t))e.removeListener(s,t[s])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,s,n)=>{this.handleUpgrade(t,s,n,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state)return e&&this.once("close",()=>{e(new Error("The server is not running"))}),void process.nextTick(f,this);if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(f,this);else{const e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{f(this)})}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,s,n){t.on("error",y);const r=e.headers["sec-websocket-key"],o=e.headers.upgrade,i=+e.headers["sec-websocket-version"];if("GET"!==e.method)return void _(this,e,t,405,"Invalid HTTP method");if(void 0===o||"websocket"!==o.toLowerCase())return void _(this,e,t,400,"Invalid Upgrade header");if(void 0===r||!p.test(r))return void _(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");if(8!==i&&13!==i)return void _(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header");if(!this.shouldHandle(e))return void m(t,400);const d=e.headers["sec-websocket-protocol"];let l=new Set;if(void 0!==d)try{l=h.parse(d)}catch(s){return void _(this,e,t,400,"Invalid Sec-WebSocket-Protocol header")}const u=e.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&void 0!==u){const s=new c(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const e=a.parse(u);e[c.extensionName]&&(s.accept(e[c.extensionName]),f[c.extensionName]=s)}catch(s){return void _(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header")}}if(this.options.verifyClient){const o={origin:e.headers[8===i?"sec-websocket-origin":"origin"],secure:!(!e.socket.authorized&&!e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(o,(o,i,a,c)=>{if(!o)return m(t,i||401,a,c);this.completeUpgrade(f,r,l,e,t,s,n)});if(!this.options.verifyClient(o))return m(t,401)}this.completeUpgrade(f,r,l,e,t,s,n)}completeUpgrade(e,t,s,n,r,o,h){if(!r.readable||!r.writable)return r.destroy();if(r[u])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return m(r,503);const d=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${i("sha1").update(t+l).digest("base64")}`],p=new this.options.WebSocket(null,void 0,this.options);if(s.size){const e=this.options.handleProtocols?this.options.handleProtocols(s,n):s.values().next().value;e&&(d.push(`Sec-WebSocket-Protocol: ${e}`),p._protocol=e)}if(e[c.extensionName]){const t=e[c.extensionName].params,s=a.format({[c.extensionName]:[t]});d.push(`Sec-WebSocket-Extensions: ${s}`),p._extensions=e}this.emit("headers",d,n),r.write(d.concat("\r\n").join("\r\n")),r.removeListener("error",y),p.setSocket(r,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(p),p.on("close",()=>{this.clients.delete(p),this._shouldEmitClose&&!this.clients.size&&process.nextTick(f,this)})),h(p,n)}}},756:e=>{"use strict";e.exports=require("tls")},759:e=>{"use strict";const t=Symbol("kDone"),s=Symbol("kRun");e.exports=class{constructor(e){this[t]=()=>{this.pending--,this[s]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[s]()}[s](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[t])}}}},834:(e,t,s)=>{const n=s(18),r=s(23);t.init=function(e){e.inspectOpts={};const s=Object.keys(t.inspectOpts);for(let n=0;n<s.length;n++)e.inspectOpts[s[n]]=t.inspectOpts[s[n]]},t.log=function(...e){return process.stderr.write(r.formatWithOptions(t.inspectOpts,...e)+"\n")},t.formatArgs=function(s){const{namespace:n,useColors:r}=this;if(r){const t=this.color,r="[3"+(t<8?t:"8;5;"+t),o=`  ${r};1m${n} [0m`;s[0]=o+s[0].split("\n").join("\n"+o),s.push(r+"m+"+e.exports.humanize(this.diff)+"[0m")}else s[0]=(t.inspectOpts.hideDate?"":(new Date).toISOString()+" ")+n+" "+s[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):n.isatty(process.stderr.fd)},t.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const e=s(687);e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{const s=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase());let n=process.env[t];return n=!!/^(yes|on|true|enabled)$/i.test(n)||!/^(no|off|false|disabled)$/i.test(n)&&("null"===n?null:Number(n)),e[s]=n,e},{}),e.exports=s(703)(t);const{formatters:o}=e.exports;o.o=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts).split("\n").map(e=>e.trim()).join(" ")},o.O=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts)}},852:(e,t,s)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const s="color: "+this.color;t.splice(1,0,s,"color: inherit");let n=0,r=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(r=n))}),t.splice(r,0,s)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=s(995)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},857:e=>{"use strict";e.exports=require("os")},880:(e,t,s)=>{"use strict";const{isUtf8:n}=s(181);function r(e){const t=e.length;let s=0;for(;s<t;)if(128&e[s])if(192==(224&e[s])){if(s+1===t||128!=(192&e[s+1])||192==(254&e[s]))return!1;s+=2}else if(224==(240&e[s])){if(s+2>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||224===e[s]&&128==(224&e[s+1])||237===e[s]&&160==(224&e[s+1]))return!1;s+=3}else{if(240!=(248&e[s]))return!1;if(s+3>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||128!=(192&e[s+3])||240===e[s]&&128==(240&e[s+1])||244===e[s]&&e[s+1]>143||e[s]>244)return!1;s+=4}else s++;return!0}if(e.exports={isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:r,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},n)e.exports.isValidUTF8=function(e){return e.length<24?r(e):n(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{const t=s(Object(function(){var e=new Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e}()));e.exports.isValidUTF8=function(e){return e.length<32?r(e):t(e)}}catch(e){}},884:e=>{"use strict";e.exports=(e,t=process.argv)=>{const s=e.startsWith("-")?"":1===e.length?"-":"--",n=t.indexOf(s+e),r=t.indexOf("--");return-1!==n&&(-1===r||n<r)}},896:e=>{"use strict";e.exports=require("fs")},914:(e,t,s)=>{"use strict";const{Duplex:n}=s(203),{randomFillSync:r}=s(982),o=s(971),{EMPTY_BUFFER:i}=s(614),{isValidStatusCode:a}=s(880),{mask:c,toBuffer:h}=s(338),d=Symbol("kByteLength"),l=Buffer.alloc(4),u=8192;let p,f=u;class y{constructor(e,t,s){this._extensions=t||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let s,n,o=!1,i=2,a=!1;t.mask&&(s=t.maskBuffer||l,t.generateMask?t.generateMask(s):(f===u&&(void 0===p&&(p=Buffer.alloc(u)),r(p,0,u),f=0),s[0]=p[f++],s[1]=p[f++],s[2]=p[f++],s[3]=p[f++]),a=0===(s[0]|s[1]|s[2]|s[3]),i=6),"string"==typeof e?n=t.mask&&!a||void 0===t[d]?(e=Buffer.from(e)).length:t[d]:(n=e.length,o=t.mask&&t.readOnly&&!a);let h=n;n>=65536?(i+=8,h=127):n>125&&(i+=2,h=126);const y=Buffer.allocUnsafe(o?n+i:i);return y[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(y[0]|=64),y[1]=h,126===h?y.writeUInt16BE(n,2):127===h&&(y[2]=y[3]=0,y.writeUIntBE(n,4,6)),t.mask?(y[1]|=128,y[i-4]=s[0],y[i-3]=s[1],y[i-2]=s[2],y[i-1]=s[3],a?[y,e]:o?(c(e,s,y,i,n),[y]):(c(e,s,e,0,n),[y,e])):[y,e]}close(e,t,s,n){let r;if(void 0===e)r=i;else{if("number"!=typeof e||!a(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const s=Buffer.byteLength(t);if(s>123)throw new RangeError("The message must not be greater than 123 bytes");r=Buffer.allocUnsafe(2+s),r.writeUInt16BE(e,0),"string"==typeof t?r.write(t,2):r.set(t,2)}else r=Buffer.allocUnsafe(2),r.writeUInt16BE(e,0)}const o={[d]:r.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,r,!1,o,n]):this.sendFrame(y.frame(r,o),n)}ping(e,t,s){let n,r;if("string"==typeof e?(n=Buffer.byteLength(e),r=!1):(n=(e=h(e)).length,r=h.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");const o={[d]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:r,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(y.frame(e,o),s)}pong(e,t,s){let n,r;if("string"==typeof e?(n=Buffer.byteLength(e),r=!1):(n=(e=h(e)).length,r=h.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");const o={[d]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:r,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(y.frame(e,o),s)}send(e,t,s){const n=this._extensions[o.extensionName];let r,i,a=t.binary?2:1,c=t.compress;if("string"==typeof e?(r=Buffer.byteLength(e),i=!1):(r=(e=h(e)).length,i=h.readOnly),this._firstFragment?(this._firstFragment=!1,c&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(c=r>=n._threshold),this._compress=c):(c=!1,a=0),t.fin&&(this._firstFragment=!0),n){const n={[d]:r,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:i,rsv1:c};this._deflating?this.enqueue([this.dispatch,e,this._compress,n,s]):this.dispatch(e,this._compress,n,s)}else this.sendFrame(y.frame(e,{[d]:r,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:i,rsv1:!1}),s)}dispatch(e,t,s,n){if(!t)return void this.sendFrame(y.frame(e,s),n);const r=this._extensions[o.extensionName];this._bufferedBytes+=s[d],this._deflating=!0,r.compress(e,s.fin,(e,t)=>{if(this._socket.destroyed){const e=new Error("The socket was closed while data was being compressed");"function"==typeof n&&n(e);for(let t=0;t<this._queue.length;t++){const s=this._queue[t],n=s[s.length-1];"function"==typeof n&&n(e)}return}this._bufferedBytes-=s[d],this._deflating=!1,s.readOnly=!1,this.sendFrame(y.frame(t,s),n),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][d],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][d],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}e.exports=y},926:(e,t,s)=>{"use strict";const{tokenChars:n}=s(880);function r(e,t,s){void 0===e[t]?e[t]=[s]:e[t].push(s)}e.exports={format:function(e){return Object.keys(e).map(t=>{let s=e[t];return Array.isArray(s)||(s=[s]),s.map(e=>[t].concat(Object.keys(e).map(t=>{let s=e[t];return Array.isArray(s)||(s=[s]),s.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){const t=Object.create(null);let s,o,i=Object.create(null),a=!1,c=!1,h=!1,d=-1,l=-1,u=-1,p=0;for(;p<e.length;p++)if(l=e.charCodeAt(p),void 0===s)if(-1===u&&1===n[l])-1===d&&(d=p);else if(0===p||32!==l&&9!==l){if(59!==l&&44!==l)throw new SyntaxError(`Unexpected character at index ${p}`);{if(-1===d)throw new SyntaxError(`Unexpected character at index ${p}`);-1===u&&(u=p);const n=e.slice(d,u);44===l?(r(t,n,i),i=Object.create(null)):s=n,d=u=-1}}else-1===u&&-1!==d&&(u=p);else if(void 0===o)if(-1===u&&1===n[l])-1===d&&(d=p);else if(32===l||9===l)-1===u&&-1!==d&&(u=p);else if(59===l||44===l){if(-1===d)throw new SyntaxError(`Unexpected character at index ${p}`);-1===u&&(u=p),r(i,e.slice(d,u),!0),44===l&&(r(t,s,i),i=Object.create(null),s=void 0),d=u=-1}else{if(61!==l||-1===d||-1!==u)throw new SyntaxError(`Unexpected character at index ${p}`);o=e.slice(d,p),d=u=-1}else if(c){if(1!==n[l])throw new SyntaxError(`Unexpected character at index ${p}`);-1===d?d=p:a||(a=!0),c=!1}else if(h)if(1===n[l])-1===d&&(d=p);else if(34===l&&-1!==d)h=!1,u=p;else{if(92!==l)throw new SyntaxError(`Unexpected character at index ${p}`);c=!0}else if(34===l&&61===e.charCodeAt(p-1))h=!0;else if(-1===u&&1===n[l])-1===d&&(d=p);else if(-1===d||32!==l&&9!==l){if(59!==l&&44!==l)throw new SyntaxError(`Unexpected character at index ${p}`);{if(-1===d)throw new SyntaxError(`Unexpected character at index ${p}`);-1===u&&(u=p);let n=e.slice(d,u);a&&(n=n.replace(/\\/g,""),a=!1),r(i,o,n),44===l&&(r(t,s,i),i=Object.create(null),s=void 0),o=void 0,d=u=-1}}else-1===u&&(u=p);if(-1===d||h||32===l||9===l)throw new SyntaxError("Unexpected end of input");-1===u&&(u=p);const f=e.slice(d,u);return void 0===s?r(t,f,i):(void 0===o?r(i,f,!0):r(i,o,a?f.replace(/\\/g,""):f),r(t,s,i)),t}}},953:(e,t,s)=>{"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?e.exports=s(617):e.exports=s(1)},971:(e,t,s)=>{"use strict";const n=s(106),r=s(338),o=s(759),{kStatusCode:i}=s(614),a=Buffer[Symbol.species],c=Buffer.from([0,0,255,255]),h=Symbol("permessage-deflate"),d=Symbol("total-length"),l=Symbol("callback"),u=Symbol("buffers"),p=Symbol("error");let f;function y(e){this[u].push(e),this[d]+=e.length}function m(e){this[d]+=e.length,this[h]._maxPayload<1||this[d]<=this[h]._maxPayload?this[u].push(e):(this[p]=new RangeError("Max payload size exceeded"),this[p].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[p][i]=1009,this.removeListener("data",m),this.reset())}function _(e){this[h]._inflate=null,e[i]=1007,this[l](e)}e.exports=class{constructor(e,t,s){if(this._maxPayload=0|s,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!f){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;f=new o(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[l];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,s=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!s)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(s.server_no_context_takeover=!0),t.clientNoContextTakeover&&(s.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(s.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?s.client_max_window_bits=t.clientMaxWindowBits:!0!==s.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete s.client_max_window_bits,s}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let s=e[t];if(s.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(s=s[0],"client_max_window_bits"===t){if(!0!==s){const e=+s;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${s}`)}else if("server_max_window_bits"===t){const e=+s;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==s)throw new TypeError(`Invalid value for parameter "${t}": ${s}`)}e[t]=s})}),e}decompress(e,t,s){f.add(n=>{this._decompress(e,t,(e,t)=>{n(),s(e,t)})})}compress(e,t,s){f.add(n=>{this._compress(e,t,(e,t)=>{n(),s(e,t)})})}_decompress(e,t,s){const o=this._isServer?"client":"server";if(!this._inflate){const e=`${o}_max_window_bits`,t="number"!=typeof this.params[e]?n.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=n.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[h]=this,this._inflate[d]=0,this._inflate[u]=[],this._inflate.on("error",_),this._inflate.on("data",m)}this._inflate[l]=s,this._inflate.write(e),t&&this._inflate.write(c),this._inflate.flush(()=>{const e=this._inflate[p];if(e)return this._inflate.close(),this._inflate=null,void s(e);const n=r.concat(this._inflate[u],this._inflate[d]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[d]=0,this._inflate[u]=[],t&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),s(null,n)})}_compress(e,t,s){const o=this._isServer?"server":"client";if(!this._deflate){const e=`${o}_max_window_bits`,t="number"!=typeof this.params[e]?n.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=n.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[d]=0,this._deflate[u]=[],this._deflate.on("data",y)}this._deflate[l]=s,this._deflate.write(e),this._deflate.flush(n.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=r.concat(this._deflate[u],this._deflate[d]);t&&(e=new a(e.buffer,e.byteOffset,e.length-4)),this._deflate[l]=null,this._deflate[d]=0,this._deflate[u]=[],t&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),s(null,e)})}}},982:e=>{"use strict";e.exports=require("crypto")},995:(e,t,s)=>{e.exports=function(e){function t(e){let s,r,o,i=null;function a(...e){if(!a.enabled)return;const n=a,r=Number(new Date),o=r-(s||r);n.diff=o,n.prev=s,n.curr=r,s=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(s,r)=>{if("%%"===s)return"%";i++;const o=t.formatters[r];if("function"==typeof o){const t=e[i];s=o.call(n,t),e.splice(i,1),i--}return s}),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(r!==t.namespaces&&(r=t.namespaces,o=t.enabled(e)),o),set:e=>{i=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,s){const n=t(this.namespace+(void 0===s?":":s)+e);return n.log=this.log,n}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(r),...t.skips.map(r).map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){let s;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(s=0;s<r;s++)n[s]&&("-"===(e=n[s].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let s,n;for(s=0,n=t.skips.length;s<n;s++)if(t.skips[s].test(e))return!1;for(s=0,n=t.names.length;s<n;s++)if(t.names[s].test(e))return!0;return!1},t.humanize=s(585),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(s=>{t[s]=e[s]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let s=0;for(let t=0;t<e.length;t++)s=(s<<5)-s+e.charCodeAt(t),s|=0;return t.colors[Math.abs(s)%t.colors.length]},t.enable(t.load()),t}}},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var o=n[e]={exports:{}};return s[e](o,o.exports,r),o.exports}t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(s,n){if(1&n&&(s=this(s)),8&n)return s;if("object"==typeof s&&s){if(4&n&&s.__esModule)return s;if(16&n&&"function"==typeof s.then)return s}var o=Object.create(null);r.r(o);var i={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&s;("object"==typeof a||"function"==typeof a)&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach(e=>i[e]=()=>s[e]);return i.default=()=>s,r.d(o,i),o},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};r.r(e),r.d(e,{Decoder:()=>ve,Encoder:()=>we,PacketType:()=>Te,protocol:()=>be});const t=require("electron"),s=require("path");var n=r(896);class o{constructor(){this.db=null;const e=s.join(process.env.APPDATA||"","ClutchPartners");n.existsSync(e)||n.mkdirSync(e,{recursive:!0}),this.dbPath=s.join(e,"partners.db")}async initialize(){try{this.db={data:new Map,query:(e,t=[])=>[],exec:(e,t=[])=>({lastInsertRowid:1})},await this.createTables(),console.log("Database initialized successfully")}catch(e){throw console.error("Database initialization failed:",e),e}}async createTables(){if(!this.db)throw new Error("Database not initialized");this.db.exec("\n      CREATE TABLE IF NOT EXISTS users (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        partner_id TEXT NOT NULL,\n        username TEXT UNIQUE NOT NULL,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'cashier',\n        permissions TEXT NOT NULL DEFAULT '[]',\n        is_active BOOLEAN NOT NULL DEFAULT 1,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      )\n    "),this.db.exec("\n      CREATE TABLE IF NOT EXISTS products (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        sku TEXT UNIQUE NOT NULL,\n        name TEXT NOT NULL,\n        description TEXT,\n        category TEXT NOT NULL,\n        brand TEXT,\n        model TEXT,\n        cost_price REAL NOT NULL,\n        sale_price REAL NOT NULL,\n        quantity INTEGER NOT NULL DEFAULT 0,\n        min_quantity INTEGER NOT NULL DEFAULT 5,\n        barcode TEXT UNIQUE,\n        images TEXT DEFAULT '[]',\n        specifications TEXT DEFAULT '{}',\n        is_active BOOLEAN NOT NULL DEFAULT 1,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      )\n    "),this.db.exec("\n      CREATE TABLE IF NOT EXISTS orders (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        order_id TEXT UNIQUE NOT NULL,\n        customer_id INTEGER,\n        customer_name TEXT,\n        customer_phone TEXT,\n        customer_email TEXT,\n        items TEXT NOT NULL DEFAULT '[]',\n        subtotal REAL NOT NULL,\n        tax REAL NOT NULL DEFAULT 0,\n        discount REAL NOT NULL DEFAULT 0,\n        total REAL NOT NULL,\n        payment_method TEXT,\n        payment_status TEXT NOT NULL DEFAULT 'pending',\n        order_status TEXT NOT NULL DEFAULT 'pending',\n        notes TEXT,\n        created_by INTEGER NOT NULL,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (created_by) REFERENCES users (id)\n      )\n    "),this.db.exec("\n      CREATE TABLE IF NOT EXISTS payments (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        payment_id TEXT UNIQUE NOT NULL,\n        order_id TEXT NOT NULL,\n        amount REAL NOT NULL,\n        method TEXT NOT NULL,\n        status TEXT NOT NULL DEFAULT 'pending',\n        reference TEXT,\n        processed_at DATETIME,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (order_id) REFERENCES orders (order_id)\n      )\n    "),this.db.exec("\n      CREATE TABLE IF NOT EXISTS sync_operations (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        operation_id TEXT UNIQUE NOT NULL,\n        entity_type TEXT NOT NULL,\n        entity_id TEXT NOT NULL,\n        operation_type TEXT NOT NULL,\n        data TEXT NOT NULL,\n        status TEXT NOT NULL DEFAULT 'pending',\n        error_message TEXT,\n        retry_count INTEGER NOT NULL DEFAULT 0,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      )\n    "),this.db.exec("\n      CREATE TABLE IF NOT EXISTS sync_operations (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        operation_id TEXT UNIQUE NOT NULL,\n        entity_type TEXT NOT NULL,\n        entity_id TEXT NOT NULL,\n        operation_type TEXT NOT NULL,\n        data TEXT NOT NULL,\n        status TEXT NOT NULL DEFAULT 'pending',\n        timestamp DATETIME NOT NULL,\n        retry_count INTEGER NOT NULL DEFAULT 0,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      )\n    "),this.db.exec("\n      CREATE TABLE IF NOT EXISTS sync_conflicts (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        operation_id TEXT UNIQUE NOT NULL,\n        entity_type TEXT NOT NULL,\n        entity_id TEXT NOT NULL,\n        local_data TEXT NOT NULL,\n        server_data TEXT NOT NULL,\n        local_timestamp DATETIME NOT NULL,\n        server_timestamp DATETIME NOT NULL,\n        resolution TEXT NOT NULL DEFAULT 'pending',\n        resolved_at DATETIME,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      )\n    "),this.db.exec("\n      CREATE TABLE IF NOT EXISTS audit_log (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        user_id INTEGER NOT NULL,\n        action TEXT NOT NULL,\n        entity_type TEXT NOT NULL,\n        entity_id TEXT NOT NULL,\n        old_data TEXT,\n        new_data TEXT,\n        ip_address TEXT,\n        user_agent TEXT,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      )\n    "),this.db.exec("\n      CREATE TABLE IF NOT EXISTS notifications (\n        id TEXT PRIMARY KEY,\n        title TEXT NOT NULL,\n        body TEXT NOT NULL,\n        icon TEXT,\n        sound BOOLEAN NOT NULL DEFAULT 1,\n        urgency TEXT NOT NULL DEFAULT 'normal',\n        actions TEXT DEFAULT '[]',\n        data TEXT DEFAULT '{}',\n        category TEXT NOT NULL DEFAULT 'system',\n        tag TEXT,\n        timestamp DATETIME NOT NULL,\n        read BOOLEAN NOT NULL DEFAULT 0,\n        persistent BOOLEAN NOT NULL DEFAULT 0,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      )\n    "),this.db.exec("\n      CREATE TABLE IF NOT EXISTS notification_log (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        type TEXT NOT NULL,\n        notification_id TEXT NOT NULL,\n        status TEXT NOT NULL,\n        error_message TEXT,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      )\n    "),this.db.exec("\n      CREATE TABLE IF NOT EXISTS settings (\n        key TEXT PRIMARY KEY,\n        value TEXT NOT NULL,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      )\n    "),this.db.exec("\n      CREATE INDEX IF NOT EXISTS idx_products_sku ON products(sku);\n      CREATE INDEX IF NOT EXISTS idx_products_barcode ON products(barcode);\n      CREATE INDEX IF NOT EXISTS idx_products_category ON products(category);\n      CREATE INDEX IF NOT EXISTS idx_orders_order_id ON orders(order_id);\n      CREATE INDEX IF NOT EXISTS idx_orders_status ON orders(order_status);\n      CREATE INDEX IF NOT EXISTS idx_orders_created_at ON orders(created_at);\n      CREATE INDEX IF NOT EXISTS idx_sync_operations_status ON sync_operations(status);\n      CREATE INDEX IF NOT EXISTS idx_sync_operations_entity ON sync_operations(entity_type, entity_id);\n    "),this.db.exec("\n      INSERT OR IGNORE INTO settings (key, value) VALUES \n      ('partner_id', ''),\n      ('business_name', ''),\n      ('currency', 'EGP'),\n      ('language', 'ar'),\n      ('theme', 'light'),\n      ('sync_interval', '30'),\n      ('auto_sync', '1'),\n      ('offline_mode', '1')\n    ")}async query(e,t=[]){if(!this.db)throw new Error("Database not initialized");try{return this.db.query(e,t)}catch(e){throw console.error("Database query error:",e),e}}async exec(e,t=[]){if(!this.db)throw new Error("Database not initialized");try{return this.db.exec(e,t)}catch(e){throw console.error("Database exec error:",e),e}}async getSetting(e){const t=await this.query("SELECT value FROM settings WHERE key = ?",[e]);return t.length>0?t[0].value:null}async setSetting(e,t){await this.exec("INSERT OR REPLACE INTO settings (key, value, updated_at) VALUES (?, ?, CURRENT_TIMESTAMP)",[e,t])}async logAuditEvent(e,t,s,n,r,o,i,a){try{await this.exec("INSERT INTO audit_log (\n          user_id, action, entity_type, entity_id, old_data, new_data, \n          ip_address, user_agent, created_at\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)",[e,t,s,n,r?JSON.stringify(r):null,o?JSON.stringify(o):null,i,a])}catch(e){console.error("Failed to log audit event:",e)}}async getAuditLog(e,t,s,n=100,r=0){try{let o="\n        SELECT al.*, u.username, u.email \n        FROM audit_log al \n        LEFT JOIN users u ON al.user_id = u.id \n        WHERE 1=1\n      ";const i=[];return e&&(o+=" AND al.entity_type = ?",i.push(e)),t&&(o+=" AND al.entity_id = ?",i.push(t)),s&&(o+=" AND al.user_id = ?",i.push(s)),o+=" ORDER BY al.created_at DESC LIMIT ? OFFSET ?",i.push(n,r),await this.query(o,i)}catch(e){return console.error("Failed to get audit log:",e),[]}}async close(){this.db&&(this.db.close(),this.db=null)}}class i{constructor(){this.port=3001,this.app={get:(e,t)=>{console.log(`GET ${e} registered`)},post:(e,t)=>{console.log(`POST ${e} registered`)},use:e=>{console.log("Middleware registered")}},this.database=new o,this.setupMiddleware(),this.setupRoutes()}setupMiddleware(){console.log("Middleware setup completed")}setupRoutes(){this.app.get("/health",(e,t)=>{t.json({status:"ok",timestamp:(new Date).toISOString()})}),this.app.get("/api/products",async(e,t)=>{try{const e=await this.database.query("SELECT * FROM products WHERE is_active = 1 ORDER BY name");t.json({success:!0,data:e})}catch(e){t.status(500).json({success:!1,error:e instanceof Error?e.message:String(e)})}}),this.app.get("/api/products/:sku",async(e,t)=>{try{const s=await this.database.query("SELECT * FROM products WHERE sku = ? AND is_active = 1",[e.params.sku]);if(0===s.length)return t.status(404).json({success:!1,error:"Product not found"});t.json({success:!0,data:s[0]})}catch(e){t.status(500).json({success:!1,error:e instanceof Error?e.message:String(e)})}}),this.app.get("/api/products/barcode/:barcode",async(e,t)=>{try{const s=await this.database.query("SELECT * FROM products WHERE barcode = ? AND is_active = 1",[e.params.barcode]);if(0===s.length)return t.status(404).json({success:!1,error:"Product not found"});t.json({success:!0,data:s[0]})}catch(e){t.status(500).json({success:!1,error:e instanceof Error?e.message:String(e)})}}),this.app.get("/api/orders",async(e,t)=>{try{const{status:s,limit:n=50,offset:r=0}=e.query;let o="SELECT * FROM orders";const i=[];s&&(o+=" WHERE order_status = ?",i.push(s)),o+=" ORDER BY created_at DESC LIMIT ? OFFSET ?",i.push(parseInt(n),parseInt(r));const a=await this.database.query(o,i);t.json({success:!0,data:a})}catch(e){t.status(500).json({success:!1,error:e instanceof Error?e.message:String(e)})}}),this.app.post("/api/orders",async(e,t)=>{try{const{order_id:s,customer_name:n,customer_phone:r,customer_email:o,items:i,subtotal:a,tax:c,discount:h,total:d,payment_method:l,notes:u,created_by:p}=e.body,f=await this.database.exec("INSERT INTO orders (\n            order_id, customer_name, customer_phone, customer_email,\n            items, subtotal, tax, discount, total, payment_method,\n            notes, created_by\n          ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[s,n,r,o,JSON.stringify(i),a,c,h,d,l,u,p]);t.json({success:!0,data:{id:f.lastInsertRowid}})}catch(e){t.status(500).json({success:!1,error:e instanceof Error?e.message:String(e)})}}),this.app.post("/api/payments",async(e,t)=>{try{const{payment_id:s,order_id:n,amount:r,method:o,reference:i}=e.body,a=await this.database.exec("INSERT INTO payments (payment_id, order_id, amount, method, reference)\n           VALUES (?, ?, ?, ?, ?)",[s,n,r,o,i]);await this.database.exec("UPDATE orders SET payment_status = ?, updated_at = CURRENT_TIMESTAMP WHERE order_id = ?",["paid",n]),t.json({success:!0,data:{id:a.lastInsertRowid}})}catch(e){t.status(500).json({success:!1,error:e instanceof Error?e.message:String(e)})}}),this.app.get("/api/settings",async(e,t)=>{try{const e=(await this.database.query("SELECT key, value FROM settings")).reduce((e,t)=>(e[t.key]=t.value,e),{});t.json({success:!0,data:e})}catch(e){t.status(500).json({success:!1,error:e instanceof Error?e.message:String(e)})}}),this.app.post("/api/settings",async(e,t)=>{try{const{key:s,value:n}=e.body;await this.database.setSetting(s,n),t.json({success:!0})}catch(e){t.status(500).json({success:!1,error:e instanceof Error?e.message:String(e)})}}),this.app.get("/api/sync/operations",async(e,t)=>{try{const{status:s="pending"}=e.query,n=await this.database.query("SELECT * FROM sync_operations WHERE status = ? ORDER BY created_at",[s]);t.json({success:!0,data:n})}catch(e){t.status(500).json({success:!1,error:e instanceof Error?e.message:String(e)})}}),this.app.post("/api/sync/operations",async(e,t)=>{try{const{operation_id:s,entity_type:n,entity_id:r,operation_type:o,data:i}=e.body,a=await this.database.exec("INSERT INTO sync_operations (operation_id, entity_type, entity_id, operation_type, data)\n           VALUES (?, ?, ?, ?, ?)",[s,n,r,o,JSON.stringify(i)]);t.json({success:!0,data:{id:a.lastInsertRowid}})}catch(e){t.status(500).json({success:!1,error:e instanceof Error?e.message:String(e)})}})}async start(){return new Promise((e,t)=>{this.server=this.app.listen(this.port,s=>{s?t(s):(console.log(`Local server started on port ${this.port}`),e())})})}async stop(){return new Promise(e=>{this.server?this.server.close(()=>{console.log("Local server stopped"),e()}):e()})}}var a=r(480),c=r.t(a,2);const h=Object.create(null);h.open="0",h.close="1",h.ping="2",h.pong="3",h.message="4",h.upgrade="5",h.noop="6";const d=Object.create(null);Object.keys(h).forEach(e=>{d[h[e]]=e});const l={type:"error",data:"parser error"},u=({type:e,data:t},s,n)=>t instanceof ArrayBuffer||ArrayBuffer.isView(t)?n(s?t:"b"+p(t,!0).toString("base64")):n(h[e]+(t||"")),p=(e,t)=>Buffer.isBuffer(e)||e instanceof Uint8Array&&!t?e:e instanceof ArrayBuffer?Buffer.from(e):Buffer.from(e.buffer,e.byteOffset,e.byteLength);let f;const y=(e,t)=>{if("string"!=typeof e)return{type:"message",data:m(e,t)};const s=e.charAt(0);if("b"===s){const s=Buffer.from(e.substring(1),"base64");return{type:"message",data:m(s,t)}}return d[s]?e.length>1?{type:d[s],data:e.substring(1)}:{type:d[s]}:l},m=(e,t)=>"arraybuffer"===t?e instanceof ArrayBuffer?e:Buffer.isBuffer(e)?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e.buffer:Buffer.isBuffer(e)?e:Buffer.from(e),_=String.fromCharCode(30);let g;function E(e){return e.reduce((e,t)=>e+t.length,0)}function b(e,t){if(e[0].length===t)return e.shift();const s=new Uint8Array(t);let n=0;for(let r=0;r<t;r++)s[r]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),s}function T(e){if(e)return function(e){for(var t in T.prototype)e[t]=T.prototype[t];return e}(e)}T.prototype.on=T.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},T.prototype.once=function(e,t){function s(){this.off(e,s),t.apply(this,arguments)}return s.fn=t,this.on(e,s),this},T.prototype.off=T.prototype.removeListener=T.prototype.removeAllListeners=T.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<n.length;r++)if((s=n[r])===t||s.fn===t){n.splice(r,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},T.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),s=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(s){n=0;for(var r=(s=s.slice(0)).length;n<r;++n)s[n].apply(this,t)}return this},T.prototype.emitReserved=T.prototype.emit,T.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},T.prototype.hasListeners=function(e){return!!this.listeners(e).length};const w=process.nextTick,C=global;class v{constructor(){this._cookies=new Map}parseCookies(e){e&&e.forEach(e=>{const t=function(e){const t=e.split("; "),s=t[0].indexOf("=");if(-1===s)return;const n=t[0].substring(0,s).trim();if(!n.length)return;let r=t[0].substring(s+1).trim();34===r.charCodeAt(0)&&(r=r.slice(1,-1));const o={name:n,value:r};for(let e=1;e<t.length;e++){const s=t[e].split("=");if(2!==s.length)continue;const n=s[0].trim(),r=s[1].trim();switch(n){case"Expires":o.expires=new Date(r);break;case"Max-Age":const e=new Date;e.setUTCSeconds(e.getUTCSeconds()+parseInt(r,10)),o.expires=e}}return o}(e);t&&this._cookies.set(t.name,t)})}get cookies(){const e=Date.now();return this._cookies.forEach((t,s)=>{var n;(null===(n=t.expires)||void 0===n?void 0:n.getTime())<e&&this._cookies.delete(s)}),this._cookies.entries()}addCookies(e){const t=[];for(const[e,s]of this.cookies)t.push(`${e}=${s.value}`);t.length&&(e.setDisableHeaderCheck(!0),e.setRequestHeader("cookie",t.join("; ")))}appendCookies(e){for(const[t,s]of this.cookies)e.append("cookie",`${t}=${s.value}`)}}function S(e,...t){return t.reduce((t,s)=>(e.hasOwnProperty(s)&&(t[s]=e[s]),t),{})}const O=C.setTimeout,k=C.clearTimeout;function N(e,t){t.useNativeTimers?(e.setTimeoutFn=O.bind(C),e.clearTimeoutFn=k.bind(C)):(e.setTimeoutFn=C.setTimeout.bind(C),e.clearTimeoutFn=C.clearTimeout.bind(C))}function L(e){return"string"==typeof e?function(e){let t=0,s=0;for(let n=0,r=e.length;n<r;n++)t=e.charCodeAt(n),t<128?s+=1:t<2048?s+=2:t<55296||t>=57344?s+=3:(n++,s+=4);return s}(e):Math.ceil(1.33*(e.byteLength||e.size))}function x(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}var R=r(953);const A=R("engine.io-client:transport");class F extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class I extends T{constructor(e){super(),this.writable=!1,N(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new F(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState?this.write(e):A("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=y(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t}(e);return t.length?"?"+t:""}}const U=R("engine.io-client:polling");class D extends I{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{U("paused"),this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(U("we are currently polling - waiting to pause"),e++,this.once("pollComplete",function(){U("pre-pause polling complete"),--e||t()})),this.writable||(U("we are currently writing - waiting to pause"),e++,this.once("drain",function(){U("pre-pause writing complete"),--e||t()}))}else t()}_poll(){U("polling"),this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){U("polling got data %s",e),((e,t)=>{const s=e.split(_),n=[];for(let e=0;e<s.length;e++){const r=y(s[e],t);if(n.push(r),"error"===r.type)break}return n})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState?this._poll():U('ignoring poll - transport state "%s"',this.readyState))}doClose(){const e=()=>{U("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(U("transport open - closing"),e()):(U("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,((e,t)=>{const s=e.length,n=new Array(s);let r=0;e.forEach((e,o)=>{u(e,!1,e=>{n[o]=e,++r===s&&t(n.join(_))})})})(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=x()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let M=!1;try{M="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const P=M,B=R("engine.io-client:polling");function j(){}class q extends D{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let s=location.port;s||(s=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){B("xhr poll");const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class W extends T{constructor(e,t,s){super(),this.createRequest=e,N(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=void 0!==s.data?s.data:null,this._create()}_create(){var e;const t=S(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(t);try{B("xhr open %s: %s",this._method,this._uri),s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&s.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(e){}if("POST"===this._method)try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{s.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var e;3===s.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(s.getResponseHeader("set-cookie"))),4===s.readyState&&(200===s.status||1223===s.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"==typeof s.status?s.status:0)},0))},B("xhr data %s",this._data),s.send(this._data)}catch(e){return void this.setTimeoutFn(()=>{this._onError(e)},0)}"undefined"!=typeof document&&(this._index=W.requestsCount++,W.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=j,e)try{this._xhr.abort()}catch(e){}"undefined"!=typeof document&&delete W.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}function X(){for(let e in W.requests)W.requests.hasOwnProperty(e)&&W.requests[e].abort()}W.requestsCount=0,W.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",X):"function"==typeof addEventListener&&addEventListener("onpagehide"in C?"pagehide":"unload",X,!1)),function(){const e=function(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||P))return new XMLHttpRequest}catch(e){}if(!t)try{return new(C[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}({xdomain:!1});e&&e.responseType}();const $=a||c;r(719),r(286),r(914);var V=r(60);r(722);const G=R("engine.io-client:websocket"),H="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class z extends I{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,s=H?{}:S(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],n=t===e.length-1;u(s,this.supportsBinary,e=>{try{this.doWrite(s,e)}catch(e){G("websocket closed before onclose event")}n&&w(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=x()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}C.WebSocket||C.MozWebSocket;const Y=R("engine.io-client:webtransport"),J={websocket:class extends z{createSocket(e,t,s){var n;if(null===(n=this.socket)||void 0===n?void 0:n._cookieJar){s.headers=s.headers||{},s.headers.cookie="string"==typeof s.headers.cookie?[s.headers.cookie]:s.headers.cookie||[];for(const[e,t]of this.socket._cookieJar.cookies)s.headers.cookie.push(`${e}=${t.value}`)}return new V(e,t,s)}doWrite(e,t){const s={};e.options&&(s.compress=e.options.compress),this.opts.perMessageDeflate&&("string"==typeof t?Buffer.byteLength(t):t.length)<this.opts.perMessageDeflate.threshold&&(s.compress=!1),this.ws.send(t,s)}},webtransport:class extends I{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{Y("transport closed gracefully"),this.onClose()}).catch(e=>{Y("transport closed due to %s",e),this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=function(e,t){g||(g=new TextDecoder);const s=[];let n=0,r=-1,o=!1;return new TransformStream({transform(i,a){for(s.push(i);;){if(0===n){if(E(s)<1)break;const e=b(s,1);o=!(128&~e[0]),r=127&e[0],n=r<126?3:126===r?1:2}else if(1===n){if(E(s)<2)break;const e=b(s,2);r=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),n=3}else if(2===n){if(E(s)<8)break;const e=b(s,8),t=new DataView(e.buffer,e.byteOffset,e.length),o=t.getUint32(0);if(o>Math.pow(2,21)-1){a.enqueue(l);break}r=o*Math.pow(2,32)+t.getUint32(4),n=3}else{if(E(s)<r)break;const e=b(s,r);a.enqueue(y(o?e:g.decode(e),t)),n=0}if(0===r||r>e){a.enqueue(l);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),n=new TransformStream({transform(e,t){!function(e,t){if(e.data instanceof ArrayBuffer||ArrayBuffer.isView(e.data))return t(p(e.data,!1));u(e,!0,e=>{f||(f=new TextEncoder),t(f.encode(e))})}(e,s=>{const n=s.length;let r;if(n<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,n);else if(n<65536){r=new Uint8Array(3);const e=new DataView(r.buffer);e.setUint8(0,126),e.setUint16(1,n)}else{r=new Uint8Array(9);const e=new DataView(r.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(n))}e.data&&"string"!=typeof e.data&&(r[0]|=128),t.enqueue(r),t.enqueue(s)})}});n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();const r=()=>{s.read().then(({done:e,value:t})=>{e?Y("session is closed"):(Y("received chunk: %o",t),this.onPacket(t),r())}).catch(e=>{Y("an error occurred while reading: %s",e)})};r();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],n=t===e.length-1;this._writer.write(s).then(()=>{n&&w(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends q{request(e={}){var t;return Object.assign(e,{xd:this.xd,cookieJar:null===(t=this.socket)||void 0===t?void 0:t._cookieJar},this.opts),new W(e=>new $(e),this.uri(),e)}}},K=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Q=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Z(e){if(e.length>8e3)throw"URI too long";const t=e,s=e.indexOf("["),n=e.indexOf("]");-1!=s&&-1!=n&&(e=e.substring(0,s)+e.substring(s,n).replace(/:/g,";")+e.substring(n,e.length));let r=K.exec(e||""),o={},i=14;for(;i--;)o[Q[i]]=r[i]||"";return-1!=s&&-1!=n&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=function(e,t){const s=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||s.splice(0,1),"/"==t.slice(-1)&&s.splice(s.length-1,1),s}(0,o.path),o.queryKey=function(e,t){const s={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,n){t&&(s[t]=n)}),s}(0,o.query),o}const ee=R("engine.io-client:socket"),te="function"==typeof addEventListener&&"function"==typeof removeEventListener,se=[];te&&addEventListener("offline",()=>{ee("closing %d connection(s) because the network was lost",se.length),se.forEach(e=>e())},!1);class ne extends T{constructor(e,t){if(super(),this.binaryType="nodebuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"==typeof e&&(t=e,e=null),e){const s=Z(e);t.hostname=s.host,t.secure="https"===s.protocol||"wss"===s.protocol,t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=Z(t.host).host);N(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},s=e.split("&");for(let e=0,n=s.length;e<n;e++){let n=s[e].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}(this.opts.query)),te&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(ee("adding listener for the 'offline' event"),this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},se.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=new v),this._open()}createTransport(e){ee('creating transport "%s"',e);const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return ee("options: %j",s),new this._transportsByName[e](s)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);const e=this.opts.rememberUpgrade&&ne.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){ee("setting transport %s",e.name),this.transport&&(ee("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){ee("socket open"),this.readyState="open",ne.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(ee('socket receive: type "%s", data "%s"',e.type,e.data),this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}else ee('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();ee("flushing %d packets in socket",e.length),this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const s=this.writeBuffer[t].data;if(s&&(e+=L(s)),t>0&&e>this._maxPayload)return ee("only send %d out of %d packets",t,this.writeBuffer.length),this.writeBuffer.slice(0,t);e+=2}return ee("payload size is %d (max: %d)",e,this._maxPayload),this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(ee("throttled timer detected, scheduling connection close"),this._pingTimeoutTime=0,w(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof s&&(n=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const r={type:e,data:t,options:s};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this._onClose("forced close"),ee("socket closing - telling transport to close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(ee("socket error %j",e),ne.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return ee("trying next transport"),this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(ee('socket close with reason: "%s"',e),this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),te&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=se.indexOf(this._offlineEventListener);-1!==e&&(ee("removing listener for the 'offline' event"),se.splice(e,1))}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}ne.protocol=4;class re extends ne{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade){ee("starting upgrade probes");for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}}_probe(e){ee('probing transport "%s"',e);let t=this.createTransport(e),s=!1;ne.priorWebsocketSuccess=!1;const n=()=>{s||(ee('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",n=>{if(!s)if("pong"===n.type&&"probe"===n.data){if(ee('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ne.priorWebsocketSuccess="websocket"===t.name,ee('pausing current transport "%s"',this.transport.name),this.transport.pause(()=>{s||"closed"!==this.readyState&&(ee("changing transport and sending upgrade packet"),h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{ee('probe transport "%s" failed',e);const s=new Error("probe error");s.transport=t.name,this.emitReserved("upgradeError",s)}}))};function r(){s||(s=!0,h(),t.close(),t=null)}const o=s=>{const n=new Error("probe error: "+s);n.transport=t.name,r(),ee('probe transport "%s" failed because of error: %s',e,s),this.emitReserved("upgradeError",n)};function i(){o("transport closed")}function a(){o("socket closed")}function c(e){t&&e.name!==t.name&&(ee('"%s" works - aborting "%s"',e.name,t.name),r())}const h=()=>{t.removeListener("open",n),t.removeListener("error",o),t.removeListener("close",i),this.off("close",a),this.off("upgrading",c)};t.once("open",n),t.once("error",o),t.once("close",i),this.once("close",a),this.once("upgrading",c),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}class oe extends re{constructor(e,t={}){const s="object"==typeof e?e:t;(!s.transports||s.transports&&"string"==typeof s.transports[0])&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(e=>J[e]).filter(e=>!!e)),super(e,s)}}var ie=r(300);const ae=ie("socket.io-client:url"),ce="function"==typeof ArrayBuffer,he=Object.prototype.toString,de="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===he.call(Blob),le="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===he.call(File);function ue(e){return ce&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||de&&e instanceof Blob||le&&e instanceof File}function pe(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,s=e.length;t<s;t++)if(pe(e[t]))return!0;return!1}if(ue(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return pe(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&pe(e[t]))return!0;return!1}function fe(e){const t=[],s=e.data,n=e;return n.data=ye(s,t),n.attachments=t.length,{packet:n,buffers:t}}function ye(e,t){if(!e)return e;if(ue(e)){const s={_placeholder:!0,num:t.length};return t.push(e),s}if(Array.isArray(e)){const s=new Array(e.length);for(let n=0;n<e.length;n++)s[n]=ye(e[n],t);return s}if("object"==typeof e&&!(e instanceof Date)){const s={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=ye(e[n],t));return s}return e}function me(e,t){return e.data=_e(e.data,t),delete e.attachments,e}function _e(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let s=0;s<e.length;s++)e[s]=_e(e[s],t);else if("object"==typeof e)for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(e[s]=_e(e[s],t));return e}const ge=r(120)("socket.io-parser"),Ee=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],be=5;var Te;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Te||(Te={}));class we{constructor(e){this.replacer=e}encode(e){return ge("encoding packet %j",e),e.type!==Te.EVENT&&e.type!==Te.ACK||!pe(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Te.EVENT?Te.BINARY_EVENT:Te.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==Te.BINARY_EVENT&&e.type!==Te.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),ge("encoded %j as %s",e,t),t}encodeAsBinary(e){const t=fe(e),s=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(s),n}}function Ce(e){return"[object Object]"===Object.prototype.toString.call(e)}class ve extends T{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===Te.BINARY_EVENT;s||t.type===Te.BINARY_ACK?(t.type=s?Te.EVENT:Te.ACK,this.reconstructor=new Se(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!ue(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(void 0===Te[s.type])throw new Error("unknown packet type "+s.type);if(s.type===Te.BINARY_EVENT||s.type===Te.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const r=e.substring(n,t);if(r!=Number(r)||"-"!==e.charAt(t))throw new Error("Illegal attachments");s.attachments=Number(r)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);s.nsp=e.substring(n,t)}else s.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const s=e.charAt(t);if(null==s||Number(s)!=s){--t;break}if(t===e.length)break}s.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!ve.isPayloadValid(s.type,n))throw new Error("invalid payload");s.data=n}return ge("decoded %s as %j",e,s),s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case Te.CONNECT:return Ce(t);case Te.DISCONNECT:return void 0===t;case Te.CONNECT_ERROR:return"string"==typeof t||Ce(t);case Te.EVENT:case Te.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===Ee.indexOf(t[0]));case Te.ACK:case Te.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Se{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=me(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Oe(e,t,s){return e.on(t,s),function(){e.off(t,s)}}const ke=ie("socket.io-client:socket"),Ne=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Le extends T{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Oe(e,"open",this.onopen.bind(this)),Oe(e,"packet",this.onpacket.bind(this)),Oe(e,"error",this.onerror.bind(this)),Oe(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,n,r;if(Ne.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:Te.EVENT,data:t,options:{}};if(o.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++;ke("emitting packet with ack id %d",e);const s=t.pop();this._registerAckCallback(e,s),o.id=e}const i=null===(n=null===(s=this.io.engine)||void 0===s?void 0:s.transport)||void 0===n?void 0:n.writable,a=this.connected&&!(null===(r=this.io.engine)||void 0===r?void 0:r._hasPingExpired());return this.flags.volatile&&!i?ke("discard packet as the transport is not currently writable"):a?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o),this.flags={},this}_registerAckCallback(e,t){var s;const n=null!==(s=this.flags.timeout)&&void 0!==s?s:this._opts.ackTimeout;if(void 0===n)return void(this.acks[e]=t);const r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&(ke("removing packet with ack id %d from the buffer",e),this.sendBuffer.splice(t,1));ke("event with ack id %d has timed out after %d ms",e,n),t.call(this,new Error("operation has timed out"))},n),o=(...e)=>{this.io.clearTimeoutFn(r),t.apply(this,e)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((s,n)=>{const r=(e,t)=>e?n(e):s(t);r.withError=!0,t.push(r),this.emit(e,...t)})}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...n)=>{if(s===this._queue[0])return null!==e?s.tryCount>this._opts.retries&&(ke("packet [%d] is discarded after %d tries",s.id,s.tryCount),this._queue.shift(),t&&t(e)):(ke("packet [%d] was successfully sent",s.id),this._queue.shift(),t&&t(null,...n)),s.pending=!1,this._drainQueue()}),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(ke("draining queue"),!this.connected||0===this._queue.length)return;const t=this._queue[0];!t.pending||e?(t.pending=!0,t.tryCount++,ke("sending packet [%d] (try n°%d)",t.id,t.tryCount),this.flags=t.flags,this.emit.apply(this,t.args)):ke("packet [%d] has already been sent and is waiting for an ack",t.id)}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){ke("transport is open - connecting"),"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Te.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){ke("close (%s)",e),this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Te.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Te.EVENT:case Te.BINARY_EVENT:this.onevent(e);break;case Te.ACK:case Te.BINARY_ACK:this.onack(e);break;case Te.DISCONNECT:this.ondisconnect();break;case Te.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];ke("emitting event %j",t),null!=e.id&&(ke("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...n){s||(s=!0,ke("sending ack %j",n),t.packet({type:Te.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];"function"==typeof t?(delete this.acks[e.id],ke("calling ack %s with %j",e.id,e.data),t.withError&&e.data.unshift(null),t.apply(this,e.data)):ke("bad ack %s",e.id)}onconnect(e,t){ke("socket connected with id %s",e),this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){ke("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(ke("performing disconnect (%s)",this.nsp),this.packet({type:Te.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function xe(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}xe.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),s=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+s:e-s}return 0|Math.min(e,this.max)},xe.prototype.reset=function(){this.attempts=0},xe.prototype.setMin=function(e){this.ms=e},xe.prototype.setMax=function(e){this.max=e},xe.prototype.setJitter=function(e){this.jitter=e};const Re=ie("socket.io-client:manager");class Ae extends T{constructor(t,s){var n;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(s=t,t=void 0),(s=s||{}).path=s.path||"/socket.io",this.opts=s,N(this,s),this.reconnection(!1!==s.reconnection),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=s.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new xe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==s.timeout?2e4:s.timeout),this._readyState="closed",this.uri=t;const r=s.parser||e;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==s.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(Re("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;Re("opening %s",this.uri),this.engine=new oe(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const n=Oe(t,"open",function(){s.onopen(),e&&e()}),r=t=>{Re("error"),this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},o=Oe(t,"error",r);if(!1!==this._timeout){const e=this._timeout;Re("connect attempt will timeout after %d",e);const s=this.setTimeoutFn(()=>{Re("connect attempt timed out after %d",e),n(),r(new Error("timeout")),t.close()},e);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}return this.subs.push(n),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){Re("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Oe(e,"ping",this.onping.bind(this)),Oe(e,"data",this.ondata.bind(this)),Oe(e,"error",this.onerror.bind(this)),Oe(e,"close",this.onclose.bind(this)),Oe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){w(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){Re("error",e),this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new Le(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return void Re("socket %s is still active, skipping close",e);this._close()}_packet(e){Re("writing packet %j",e);const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){Re("cleanup"),this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){Re("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;Re("closed due to %s",e),this.cleanup(),null===(s=this.engine)||void 0===s||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)Re("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();Re("will wait %dms before reconnect attempt",t),this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(Re("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(Re("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):(Re("reconnect success"),e.onreconnect())}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Fe=ie("socket.io-client"),Ie={};function Ue(e,t){"object"==typeof e&&(t=e,e=void 0);const s=function(e,t="",s){let n=e;s=s||"undefined"!=typeof location&&location,null==e&&(e=s.protocol+"//"+s.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?s.protocol+e:s.host+e),/^(https?|wss?):\/\//.test(e)||(ae("protocol-less url %s",e),e=void 0!==s?s.protocol+"//"+e:"https://"+e),ae("parse %s",e),n=Z(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port+t,n.href=n.protocol+"://"+r+(s&&s.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),n=s.source,r=s.id,o=s.path,i=Ie[r]&&o in Ie[r].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||i?(Fe("ignoring socket cache for %s",n),a=new Ae(n,t)):(Ie[r]||(Fe("new io instance for %s",n),Ie[r]=new Ae(n,t)),a=Ie[r]),s.query&&!t.query&&(t.query=s.queryKey),a.socket(s.path,t)}Object.assign(Ue,{Manager:Ae,Socket:Le,io:Ue,connect:Ue});class De{constructor(){this.socket=null,this.syncInterval=null,this.isOnline=!1,this.partnerId="",this.deviceId="",this.apiUrl="https://clutch-main-nk7x.onrender.com",this.syncQueue=[],this.isSyncing=!1,this.lastSyncTimestamp=null,this.retryCount=0,this.maxRetries=3,this.conflictResolutionStrategy="local_wins",this.pendingOperations=[],this.database=new o}async initialize(){this.partnerId=await this.database.getSetting("partner_id")||"",this.deviceId=await this.database.getSetting("device_id")||"",this.partnerId&&this.deviceId&&(await this.connect(),this.startSyncInterval())}async connect(){try{this.socket=Ue(`${this.apiUrl}/ws/partners/${this.partnerId}`,{transports:["websocket","polling"],timeout:1e4,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3}),this.socket.on("connect",()=>{console.log("Connected to sync server"),this.isOnline=!0,this.socket?.emit("device_join",{deviceId:this.deviceId})}),this.socket.on("disconnect",()=>{console.log("Disconnected from sync server"),this.isOnline=!1}),this.socket.on("new_order",e=>{this.handleNewOrder(e)}),this.socket.on("payment_update",e=>{this.handlePaymentUpdate(e)}),this.socket.on("sync_conflict",e=>{this.handleSyncConflict(e)}),this.socket.on("connect_error",e=>{console.error("Sync connection error:",e instanceof Error?e.message:String(e)),this.isOnline=!1})}catch(e){console.error("Failed to connect to sync server:",e instanceof Error?e.message:String(e)),this.isOnline=!1}}async startSyncInterval(){const e=60*parseInt(await this.database.getSetting("sync_interval")||"30")*1e3;this.syncInterval=setInterval(async()=>{this.isOnline&&await this.syncPendingOperations()},e)}async pushOperations(e){try{for(const t of e)await this.database.exec("INSERT OR REPLACE INTO sync_operations \n           (operation_id, entity_type, entity_id, operation_type, data, status)\n           VALUES (?, ?, ?, ?, ?, ?)",[t.operationId,t.entityType,t.entityId,t.operationType,JSON.stringify(t.data),"pending"]);if(this.isOnline){const t=await fetch(`${this.apiUrl}/api/v1/partners/${this.partnerId}/sync`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await this.database.getSetting("auth_token")}`},body:JSON.stringify({operations:e})});if(t.ok){const e=await t.json();await this.handleSyncResponse(e)}else console.error("Failed to push operations to server")}return{success:!0}}catch(e){return console.error("Push operations error:",e instanceof Error?e.message:String(e)),{success:!1,error:e instanceof Error?e.message:String(e)}}}async pullChanges(e){try{if(!this.isOnline)return{success:!1,error:"Offline"};const t=await fetch(`${this.apiUrl}/api/v1/partners/${this.partnerId}/sync?since=${e||""}`,{headers:{Authorization:`Bearer ${await this.database.getSetting("auth_token")}`}});if(t.ok){const e=await t.json();return await this.handlePullResponse(e),{success:!0,data:e.data}}return{success:!1,error:"Failed to pull changes"}}catch(e){return console.error("Pull changes error:",e instanceof Error?e.message:String(e)),{success:!1,error:e instanceof Error?e.message:String(e)}}}async getStatus(){try{const e=await this.database.query("SELECT COUNT(*) as count FROM sync_operations WHERE status = ?",["pending"]),t=await this.database.query("SELECT COUNT(*) as count FROM sync_operations WHERE status = ?",["failed"]),s=await this.database.getSetting("last_sync");return{isOnline:this.isOnline,pendingOperations:e[0]?.count||0,failedOperations:t[0]?.count||0,lastSync:s,partnerId:this.partnerId,deviceId:this.deviceId}}catch(e){return console.error("Get sync status error:",e instanceof Error?e.message:String(e)),{isOnline:!1,pendingOperations:0,failedOperations:0,lastSync:null,partnerId:"",deviceId:""}}}async syncPendingOperations(){try{const e=await this.database.query("SELECT * FROM sync_operations WHERE status = ? ORDER BY created_at",["pending"]);if(e.length>0){const t=e.map(e=>({operationId:e.operation_id,entityType:e.entity_type,entityId:e.entity_id,operationType:e.operation_type,data:JSON.parse(e.data),status:e.status}));await this.pushOperations(t)}await this.database.setSetting("last_sync",(new Date).toISOString())}catch(e){console.error("Sync pending operations error:",e instanceof Error?e.message:String(e))}}async handleSyncResponse(e){try{for(const t of e.data.operations)await this.database.exec("UPDATE sync_operations SET status = ?, updated_at = CURRENT_TIMESTAMP WHERE operation_id = ?",[t.status,t.operationId])}catch(e){console.error("Handle sync response error:",e instanceof Error?e.message:String(e))}}async handlePullResponse(e){try{for(const t of e.data.operations)await this.applyOperation(t)}catch(e){console.error("Handle pull response error:",e instanceof Error?e.message:String(e))}}async applyOperation(e){try{switch(e.entityType){case"order":await this.applyOrderOperation(e);break;case"inventory":await this.applyInventoryOperation(e);break;case"payment":await this.applyPaymentOperation(e);break;default:console.log("Unknown entity type:",e.entityType)}}catch(e){console.error("Apply operation error:",e instanceof Error?e.message:String(e))}}async applyOrderOperation(e){const{operationType:t,data:s}=e;switch(t){case"create":case"update":await this.database.exec("INSERT OR REPLACE INTO orders (\n            order_id, customer_name, customer_phone, customer_email,\n            items, subtotal, tax, discount, total, payment_method,\n            payment_status, order_status, notes, created_by, created_at, updated_at\n          ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[s.order_id,s.customer_name,s.customer_phone,s.customer_email,JSON.stringify(s.items),s.subtotal,s.tax,s.discount,s.total,s.payment_method,s.payment_status,s.order_status,s.notes,s.created_by,s.created_at,s.updated_at]);break;case"delete":await this.database.exec("DELETE FROM orders WHERE order_id = ?",[s.order_id])}}async applyInventoryOperation(e){const{operationType:t,data:s}=e;switch(t){case"create":case"update":await this.database.exec("INSERT OR REPLACE INTO products (\n            sku, name, description, category, brand, model,\n            cost_price, sale_price, quantity, min_quantity, barcode,\n            images, specifications, is_active, created_at, updated_at\n          ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[s.sku,s.name,s.description,s.category,s.brand,s.model,s.cost_price,s.sale_price,s.quantity,s.min_quantity,s.barcode,JSON.stringify(s.images||[]),JSON.stringify(s.specifications||{}),s.is_active?1:0,s.created_at,s.updated_at]);break;case"delete":await this.database.exec("DELETE FROM products WHERE sku = ?",[s.sku])}}async applyPaymentOperation(e){const{operationType:t,data:s}=e;switch(t){case"create":case"update":await this.database.exec("INSERT OR REPLACE INTO payments (\n            payment_id, order_id, amount, method, status, reference, processed_at, created_at\n          ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)",[s.payment_id,s.order_id,s.amount,s.method,s.status,s.reference,s.processed_at,s.created_at]);break;case"delete":await this.database.exec("DELETE FROM payments WHERE payment_id = ?",[s.payment_id])}}async handleNewOrder(e){try{await this.applyOrderOperation({operationType:"create",data:e}),console.log("New order received and applied:",e.order_id)}catch(e){console.error("Handle new order error:",e instanceof Error?e.message:String(e))}}async handlePaymentUpdate(e){try{await this.applyPaymentOperation({operationType:"update",data:e}),console.log("Payment update received and applied:",e.payment_id)}catch(e){console.error("Handle payment update error:",e instanceof Error?e.message:String(e))}}async handleSyncConflict(e){try{await this.database.exec("INSERT OR REPLACE INTO sync_operations \n         (operation_id, entity_type, entity_id, operation_type, data, status)\n         VALUES (?, ?, ?, ?, ?, ?)",[e.operationId,e.entityType,e.entityId,e.operationType,JSON.stringify(e),"conflict"]),console.log("Sync conflict detected:",e.operationId)}catch(e){console.error("Handle sync conflict error:",e instanceof Error?e.message:String(e))}}async stop(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null),this.socket&&(this.socket.disconnect(),this.socket=null),this.isOnline=!1}}class Me{constructor(){this.notifications=new Map}async initialize(){t.Notification.isSupported()||console.warn("Desktop notifications are not supported on this system")}async show(e){try{if(!t.Notification.isSupported())return console.log("Notification (not supported):",e.title,e.body),{success:!1};const s=new t.Notification({title:e.title,body:e.body,icon:e.icon||"assets/icons/app-icon.png",sound:!1!==e.sound?"default":"none",urgency:e.urgency||"normal",actions:e.actions||[]}),n=`notification_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return this.notifications.set(n,s),s.on("click",()=>{console.log("Notification clicked:",n),this.notifications.delete(n)}),s.on("close",()=>{console.log("Notification closed:",n),this.notifications.delete(n)}),s.on("action",(e,t)=>{console.log("Notification action clicked:",n,t),this.notifications.delete(n)}),s.show(),{success:!0,id:n}}catch(e){return console.error("Show notification error:",e),{success:!1}}}async showOrderNotification(e){const t={title:"طلب جديد",body:`طلب جديد من ${e.customer_name} - ${e.total} ${e.currency||"EGP"}`,urgency:"normal",actions:[{type:"button",text:"عرض الطلب"}]};return await this.show(t)}async showPaymentNotification(e){const t={title:"تحديث الدفع",body:`${"paid"===e.status?"تم الدفع":"فشل الدفع"} - ${e.amount} ${e.currency||"EGP"}`,urgency:"paid"===e.status?"normal":"critical",actions:[{type:"button",text:"عرض التفاصيل"}]};return await this.show(t)}async showSyncNotification(e,t=!1){const s={title:"مزامنة البيانات",body:e,urgency:t?"critical":"normal"};return await this.show(s)}async showLowStockNotification(e){const t={title:"مخزون منخفض",body:`المنتج ${e.name} يحتاج إعادة تموين (${e.quantity} متبقي)`,urgency:"normal",actions:[{type:"button",text:"عرض المنتج"}]};return await this.show(t)}async showErrorNotification(e){const t={title:"خطأ في النظام",body:e,urgency:"critical",actions:[{type:"button",text:"عرض التفاصيل"}]};return await this.show(t)}async showSuccessNotification(e){const t={title:"تم بنجاح",body:e,urgency:"normal"};return await this.show(t)}closeAll(){this.notifications.forEach((e,t)=>{e.close(),this.notifications.delete(t)})}close(e){const t=this.notifications.get(e);t&&(t.close(),this.notifications.delete(e))}}(new class{constructor(){this.mainWindow=null,this.localServer=new i,this.database=new o,this.syncManager=new De,this.notificationManager=new Me}async initialize(){await this.database.initialize(),await this.localServer.start(),await this.syncManager.initialize(),await this.notificationManager.initialize()}createWindow(){this.mainWindow=new t.BrowserWindow({width:1400,height:900,minWidth:1200,minHeight:800,icon:s.join(__dirname,"../assets/icons/app-icon.png"),webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:s.join(__dirname,"preload.js")},titleBarStyle:"default",show:!1}),this.mainWindow.loadFile(s.join(__dirname,"index.html")),this.mainWindow.once("ready-to-show",()=>{this.mainWindow?.show()}),this.mainWindow.on("closed",()=>{this.mainWindow=null}),this.mainWindow.webContents.setWindowOpenHandler(({url:e})=>(t.shell.openExternal(e),{action:"deny"}))}createMenu(){const e=[{label:"File",submenu:[{label:"New Sale",accelerator:"CmdOrCtrl+N",click:()=>{this.mainWindow?.webContents.send("menu-new-sale")}},{label:"Open Inventory",accelerator:"CmdOrCtrl+I",click:()=>{this.mainWindow?.webContents.send("menu-open-inventory")}},{type:"separator"},{label:"Sync Data",accelerator:"CmdOrCtrl+S",click:()=>{this.mainWindow?.webContents.send("menu-sync-data")}},{type:"separator"},{label:"Exit",accelerator:"darwin"===process.platform?"Cmd+Q":"Ctrl+Q",click:()=>{t.app.quit()}}]},{label:"Edit",submenu:[{role:"undo"},{role:"redo"},{type:"separator"},{role:"cut"},{role:"copy"},{role:"paste"}]},{label:"View",submenu:[{role:"reload"},{role:"forceReload"},{role:"toggleDevTools"},{type:"separator"},{role:"resetZoom"},{role:"zoomIn"},{role:"zoomOut"},{type:"separator"},{role:"togglefullscreen"}]},{label:"Window",submenu:[{role:"minimize"},{role:"close"}]},{label:"Help",submenu:[{label:"About Clutch Partners System",click:()=>{t.dialog.showMessageBox(this.mainWindow,{type:"info",title:"About",message:"Clutch Partners System",detail:"Production-ready POS and Inventory Management System\nVersion 1.0.0"})}}]}],s=t.Menu.buildFromTemplate(e);t.Menu.setApplicationMenu(s)}setupIPC(){t.ipcMain.handle("db-query",async(e,t,s)=>await this.database.query(t,s)),t.ipcMain.handle("db-exec",async(e,t,s)=>await this.database.exec(t,s)),t.ipcMain.handle("sync-push",async(e,t)=>await this.syncManager.pushOperations(t)),t.ipcMain.handle("sync-pull",async(e,t)=>await this.syncManager.pullChanges(t)),t.ipcMain.handle("sync-status",async()=>await this.syncManager.getStatus()),t.ipcMain.handle("notification-show",async(e,t)=>await this.notificationManager.show(t)),t.ipcMain.handle("file-select",async(e,s)=>await t.dialog.showOpenDialog(this.mainWindow,s)),t.ipcMain.handle("file-save",async(e,s)=>await t.dialog.showSaveDialog(this.mainWindow,s)),t.ipcMain.handle("print-receipt",async(e,t)=>({success:!0})),t.ipcMain.handle("print-barcode",async(e,t)=>({success:!0})),t.ipcMain.handle("app-info",()=>({version:t.app.getVersion(),name:t.app.getName(),platform:process.platform,arch:process.arch}))}async run(){await t.app.whenReady(),await this.initialize(),this.createWindow(),this.createMenu(),this.setupIPC(),t.app.on("activate",()=>{0===t.BrowserWindow.getAllWindows().length&&this.createWindow()}),t.app.on("window-all-closed",()=>{"darwin"!==process.platform&&t.app.quit()}),t.app.on("before-quit",async()=>{await this.cleanup()})}async cleanup(){await this.syncManager.stop(),await this.localServer.stop(),await this.database.close()}}).run().catch(console.error)})()})();